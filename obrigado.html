<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sua Dieta Personalizada - Dra. Giovana Nutricionista</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2c7a2c;
            --secondary: #4a9f4a;
            --accent: #6cc04a;
            --dark: #0a0a0a;
            --light: #ffffff;
            --gray: #1a1a1a;
            --success: #00ff88;
            --danger: #ff3366;
            --gold: #FFD700;
            --economy: #28a745;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, rgba(44, 122, 44, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(108, 192, 74, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(74, 159, 74, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            min-height: 100vh;
            color: var(--light);
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--accent);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
            opacity: 0.3;
        }

        .particle:nth-child(odd) {
            background: var(--primary);
            animation-duration: 8s;
        }

        .particle:nth-child(3n) {
            background: var(--secondary);
            animation-duration: 10s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
            50% { transform: translateY(-100px) rotate(180deg); opacity: 0.8; }
        }

        .header {
            position: relative;
            z-index: 100;
            padding: 20px 0;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(44, 122, 44, 0.2);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 20px rgba(44, 122, 44, 0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 10;
        }

        .success-header {
            text-align: center;
            margin-bottom: 50px;
            animation: slideInUp 1s ease-out;
        }

        .success-icon {
            font-size: 100px;
            margin-bottom: 20px;
            animation: successBounce 1.5s ease-out;
        }

        .success-title {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--success), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .success-subtitle {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
            line-height: 1.5;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .economy-badge {
            background: linear-gradient(135deg, var(--economy), #20c997);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 10px 0;
            display: inline-block;
        }

        .welcome-card {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(30px);
            border-radius: 32px;
            padding: 40px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(44, 122, 44, 0.2);
            box-shadow: 
                0 32px 64px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .welcome-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary), var(--accent), var(--secondary));
            border-radius: 32px;
            padding: 2px;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: xor;
            -webkit-mask-composite: xor;
            opacity: 0.6;
            animation: borderGlow 3s ease-in-out infinite alternate;
        }

        @keyframes borderGlow {
            0% { opacity: 0.3; }
            100% { opacity: 0.8; }
        }

        .user-name {
            font-size: 32px;
            font-weight: 800;
            color: var(--accent);
            margin-bottom: 15px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
            margin-bottom: 50px;
            align-items: start;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
            min-width: 0;
        }

        .diet-card {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(30px);
            border-radius: 24px;
            padding: 35px;
            border: 1px solid rgba(44, 122, 44, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .diet-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .diet-card:hover::before {
            left: 100%;
        }

        .card-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--light), rgba(255, 255, 255, 0.8));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .profile-summary {
            background: linear-gradient(135deg, rgba(44, 122, 44, 0.1), rgba(108, 192, 74, 0.1));
            border: 2px solid rgba(44, 122, 44, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .profile-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            min-width: 0;
        }

        .profile-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .profile-item > div {
            min-width: 0;
            word-wrap: break-word;
        }

        .macros-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .macro-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            min-width: 0;
        }

        .macro-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(44, 122, 44, 0.2);
        }

        .macro-card.calories {
            border-color: var(--danger);
            background: rgba(255, 51, 102, 0.1);
        }

        .macro-card.protein {
            border-color: var(--primary);
            background: rgba(44, 122, 44, 0.1);
        }

        .macro-card.carbs {
            border-color: var(--gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .macro-card.fats {
            border-color: var(--accent);
            background: rgba(108, 192, 74, 0.1);
        }

        .macro-icon {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .macro-value {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 5px;
            word-break: break-word;
        }

        .macro-value.calories { color: var(--danger); }
        .macro-value.protein { color: var(--primary); }
        .macro-value.carbs { color: var(--gold); }
        .macro-value.fats { color: var(--accent); }

        .macro-label {
            font-size: 12px;
            font-weight: 700;
            color: var(--light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            word-break: break-word;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
            min-width: 0;
        }

        .download-section {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(30px);
            border-radius: 24px;
            padding: 30px;
            border: 1px solid rgba(44, 122, 44, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 20px;
            width: 100%;
            max-width: 100%;
        }

        .download-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 20px;
            text-align: center;
            color: var(--accent);
        }

        .download-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            width: 100%;
            min-width: 0;
        }

        .download-item:hover {
            background: rgba(44, 122, 44, 0.1);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .download-item.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: rgba(255, 255, 255, 0.03);
        }

        .download-item.disabled:hover {
            background: rgba(255, 255, 255, 0.03);
            border-color: rgba(255, 255, 255, 0.1);
            transform: none;
        }

        .download-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .download-item.disabled .download-icon {
            background: rgba(255, 255, 255, 0.2);
        }

        .download-info {
            flex: 1;
            min-width: 0;
        }

        .download-name {
            font-size: 14px;
            font-weight: 700;
            color: var(--light);
            margin-bottom: 3px;
            word-wrap: break-word;
        }

        .download-desc {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            word-wrap: break-word;
        }

        .download-button {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
            margin-top: 20px;
        }

        .download-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(44, 122, 44, 0.4);
        }

        .members-area-info {
            background: rgba(0, 123, 255, 0.1);
            border: 1px solid rgba(0, 123, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .members-area-info h4 {
            color: #00bfff;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .members-area-info p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
        }

        .economy-highlight {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.15), rgba(32, 201, 151, 0.15));
            border: 2px solid rgba(40, 167, 69, 0.4);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .economy-highlight h4 {
            color: var(--economy);
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 700;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes successBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr 350px;
                gap: 30px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            .success-title {
                font-size: 32px;
            }

            .success-subtitle {
                font-size: 16px;
            }

            .content-grid {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .main-content {
                order: -1;
            }

            .sidebar {
                order: 1;
            }

            .profile-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
            }

            .macros-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .download-section {
                position: static;
            }

            .diet-card, .welcome-card, .download-section {
                padding: 25px 20px;
            }

            .logo {
                font-size: 20px;
            }

            .logo-icon {
                width: 35px;
                height: 35px;
                font-size: 18px;
            }
        }

        @media (max-width: 480px) {
            .success-icon {
                font-size: 70px;
            }

            .success-title {
                font-size: 28px;
            }

            .macros-grid {
                grid-template-columns: 1fr;
            }

            .diet-card, .welcome-card, .download-section {
                padding: 20px 15px;
                border-radius: 16px;
            }

            .profile-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="particles" id="particles"></div>

    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üë©‚Äç‚öïÔ∏è</div>
                <span>Dra. Giovana Nutricionista</span>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="success-header">
            <div class="success-icon">üéâ</div>
            <h1 class="success-title">Parab√©ns! Sua Dieta Econ√¥mica Est√° Pronta!</h1>
            <p class="success-subtitle">
                Seu plano nutricional personalizado foi criado com foco em <strong>alimentos acess√≠veis e nutritivos</strong>. 
                Agora voc√™ tem tudo que precisa para alcan√ßar seus objetivos sem pesar no or√ßamento!
            </p>
            <div class="economy-badge">üí∞ Dieta Econ√¥mica - Alimentos B√°sicos</div>
        </div>

        <div class="welcome-card">
            <h2 class="user-name" id="userName">Ol√°, Cliente!</h2>
            <p style="font-size: 16px; color: rgba(255, 255, 255, 0.8); line-height: 1.5;">
                Seu protocolo nutricional econ√¥mico est√° pronto! Desenvolvido com <strong>alimentos b√°sicos e acess√≠veis</strong> 
                que voc√™ encontra em qualquer mercado, sem comprometer a qualidade nutricional.
            </p>
            
            <div class="economy-highlight">
                <h4>üí° Foco em Economia</h4>
                <p style="color: rgba(255, 255, 255, 0.9); font-size: 14px;">
                    Todos os alimentos desta dieta foram escolhidos pensando no seu bolso. Ingredientes b√°sicos, 
                    nutritivos e que cabem no or√ßamento de qualquer fam√≠lia brasileira.
                </p>
            </div>
        </div>

        <div class="content-grid">
            <div class="main-content">
                <div class="diet-card">
                    <h3 class="card-title">üìä Seu Perfil Nutricional</h3>
                    
                    <div class="profile-summary">
                        <div class="profile-grid" id="profileGrid">
                            <div class="profile-item">
                                <div class="profile-icon">üéØ</div>
                                <div>
                                    <strong>Objetivo:</strong><br>
                                    <span id="userGoal">Perder Peso</span>
                                </div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-icon">‚öñÔ∏è</div>
                                <div>
                                    <strong>Peso Atual:</strong><br>
                                    <span id="userWeight">70kg</span>
                                </div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-icon">üìè</div>
                                <div>
                                    <strong>Altura:</strong><br>
                                    <span id="userHeight">170cm</span>
                                </div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-icon">üéÇ</div>
                                <div>
                                    <strong>Idade:</strong><br>
                                    <span id="userAge">26-35 anos</span>
                                </div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-icon">üèÉ</div>
                                <div>
                                    <strong>Atividade:</strong><br>
                                    <span id="userActivity">Moderada</span>
                                </div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-icon">üí∞</div>
                                <div>
                                    <strong>Foco:</strong><br>
                                    <span id="userDiet">Alimentos Econ√¥micos</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4 style="font-size: 18px; font-weight: 700; margin-bottom: 15px; color: var(--accent);">üî¢ Suas Metas Di√°rias</h4>
                    <div class="macros-grid">
                        <div class="macro-card calories">
                            <div class="macro-icon">üî•</div>
                            <div class="macro-value calories" id="targetCalories">1500</div>
                            <div class="macro-label">Calorias</div>
                        </div>
                        <div class="macro-card protein">
                            <div class="macro-icon">ü•©</div>
                            <div class="macro-value protein" id="targetProtein">120g</div>
                            <div class="macro-label">Prote√≠nas</div>
                        </div>
                        <div class="macro-card carbs">
                            <div class="macro-icon">üåæ</div>
                            <div class="macro-value carbs" id="targetCarbs">150g</div>
                            <div class="macro-label">Carboidratos</div>
                        </div>
                        <div class="macro-card fats">
                            <div class="macro-icon">ü•ë</div>
                            <div class="macro-value fats" id="targetFats">50g</div>
                            <div class="macro-label">Gorduras</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="download-section">
                    <h3 class="download-title">üìÅ Seus Materiais</h3>
                    
                    <div class="download-item" onclick="downloadFile('dieta-personalizada')">
                        <div class="download-icon">üìã</div>
                        <div class="download-info">
                            <div class="download-name">Dieta Econ√¥mica Personalizada</div>
                            <div class="download-desc">Plano completo com alimentos baratos</div>
                        </div>
                    </div>

                    <div class="download-item disabled">
                        <div class="download-icon">üìÖ</div>
                        <div class="download-info">
                            <div class="download-name">Card√°pio 30 Dias Econ√¥mico</div>
                            <div class="download-desc">Dispon√≠vel na √°rea de membros</div>
                        </div>
                    </div>

                    <div class="download-item disabled">
                        <div class="download-icon">üë©‚Äçüç≥</div>
                        <div class="download-info">
                            <div class="download-name">200+ Receitas Baratas</div>
                            <div class="download-desc">Dispon√≠vel na √°rea de membros</div>
                        </div>
                    </div>

                    <div class="download-item disabled">
                        <div class="download-icon">üí∞</div>
                        <div class="download-info">
                            <div class="download-name">Lista de Compras Econ√¥mica</div>
                            <div class="download-desc">Dispon√≠vel na √°rea de membros</div>
                        </div>
                    </div>

                    <button class="download-button" onclick="downloadFile('dieta-personalizada')">
                        üì• BAIXAR DIETA ECON√îMICA
                    </button>

                    <div class="members-area-info">
                        <h4>üîë √Årea de Membros</h4>
                        <p>Os demais materiais (card√°pio econ√¥mico, receitas baratas e lista de compras) est√£o dispon√≠veis na sua √°rea de membros exclusiva. O link de acesso foi enviado para o seu e-mail!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‚úÖ SISTEMA CORRIGIDO PARA LER DADOS DA P√ÅGINA INDEX
        const DataStorage = {
            // Verificar se localStorage est√° dispon√≠vel
            isLocalStorageAvailable: function() {
                try {
                    const testKey = 'test_' + Date.now();
                    localStorage.setItem(testKey, 'test');
                    localStorage.removeItem(testKey);
                    return true;
                } catch (e) {
                    return false;
                }
            },
            
            // ‚úÖ LER DADOS COM O MESMO SISTEMA DA P√ÅGINA INDEX
            getItem: function(key) {
                const fullKey = 'dra_giovana_' + key;
                if (this.isLocalStorageAvailable()) {
                    try {
                        const value = localStorage.getItem(fullKey);
                        if (value) {
                            console.log(`üìÑ Dados recuperados do localStorage: ${key}`);
                            return JSON.parse(value);
                        }
                    } catch (e) {
                        console.warn('Erro ao ler localStorage:', e);
                    }
                }
                return null;
            }
        };

        // ‚úÖ FUN√á√ÉO CORRIGIDA PARA LER DADOS DA P√ÅGINA INDEX
        function getQuizData() {
            try {
                // ‚úÖ USAR quiz_data COMO FONTE PRINCIPAL (mais completo)
                if (quizData && quizData.answers && quizData.results) {
                    return {
                        answers: quizData.answers,
                        results: quizData.results,
                        contact: quizData.answers.contact || {},
                        hasData: true,
                        source: 'quiz_data'
                    };
                }
                
                // ‚úÖ FALLBACK PARA checkout_data SE DISPON√çVEL
                if (checkoutData && checkoutData.answers && checkoutData.results) {
                    return {
                        answers: checkoutData.answers,
                        results: checkoutData.results,
                        contact: checkoutData.answers.contact || {},
                        hasData: true,
                        source: 'checkout_data'
                    };
                }
                
                // ‚úÖ √öLTIMO FALLBACK PARA user_profile (dados parciais)
                if (userProfile) {
                    return {
                        answers: {
                            goal: userProfile.goal,
                            contact: {
                                name: userProfile.name,
                                email: userProfile.email
                            }
                        },
                        results: {
                            bmr: userProfile.bmr,
                            targetCalories: userProfile.targetCalories,
                            projectedWeightChange: userProfile.projectedWeightChange
                        },
                        contact: {
                            name: userProfile.name,
                            email: userProfile.email
                        },
                        hasData: true,
                        source: 'user_profile'
                    };
                }
                
                console.log('‚ö†Ô∏è Nenhum dado do quiz encontrado');
                return {
                    answers: {},
                    results: {},
                    contact: {},
                    hasData: false,
                    source: 'none'
                };
                
            } catch (error) {
                console.error('‚ùå Erro ao ler dados do quiz:', error);
                return {
                    answers: {},
                    results: {},
                    contact: {},
                    hasData: false,
                    source: 'error'
                };
            }
        }

        // Dados padr√£o caso n√£o tenha dados do quiz
        const defaultUserData = {
            name: "Cliente",
            goal: "lose_weight",
            gender: "female",
            age: "26-35",
            activity: "moderate",
            weight: 75,
            height: 165,
            targetWeight: 65,
            diet: "no_restrictions",
            health: ["healthy"],
            allergies: ["no_allergies"],
            dataSource: 'default'
        };

        // Tradu√ß√µes completas
        const translations = {
            goal: {
                lose_weight: "Perder Peso",
                gain_muscle: "Ganhar Massa Muscular", 
                maintain: "Manter Peso",
                health: "Melhorar Sa√∫de"
            },
            gender: {
                male: "Masculino",
                female: "Feminino"
            },
            activity: {
                sedentary: "Sedent√°rio",
                light: "Leve",
                moderate: "Moderada",
                intense: "Intensa"
            },
            diet: {
                no_restrictions: "Alimentos Econ√¥micos",
                vegetarian: "Vegetariana Econ√¥mica",
                vegan: "Vegana Econ√¥mica",
                low_carb: "Low Carb Econ√¥mico",
                mediterranean: "Mediterr√¢nea Econ√¥mica",
                paleo: "Paleo Econ√¥mico"
            },
            age: {
                "18-25": "18-25 anos",
                "26-35": "26-35 anos", 
                "36-45": "36-45 anos",
                "46-55": "46-55 anos",
                "55+": "55+ anos"
            },
            health: {
                healthy: "Saud√°vel",
                diabetes: "Diabetes",
                hypertension: "Hipertens√£o",
                thyroid: "Problemas na Tireoide",
                digestive: "Problemas Digestivos",
                kidney: "Problemas Renais",
                heart: "Problemas Card√≠acos"
            },
            allergies: {
                no_allergies: "Sem Alergias",
                lactose: "Intoler√¢ncia √† Lactose",
                gluten: "Intoler√¢ncia ao Gl√∫ten",
                nuts: "Alergia a Oleaginosas",
                seafood: "Alergia a Frutos do Mar",
                eggs: "Alergia a Ovos",
                soy: "Alergia √† Soja"
            }
        };

        // ‚úÖ FUN√á√ÉO MELHORADA PARA PROCESSAR DADOS
        function processUserData(quizData) {
            console.log('üîÑ Processando dados do usu√°rio:', quizData);
            
            if (!quizData.hasData) {
                console.log('üìù Usando dados padr√£o - n√£o h√° dados do quiz');
                return {
                    ...defaultUserData,
                    dataSource: 'default'
                };
            }
            
            const { answers, contact, results } = quizData;
            
            // ‚úÖ EXTRAIR DADOS COM ESTRUTURA CORRETA DA P√ÅGINA INDEX
            const physical = answers.physical || {};
            
            const processedData = {
                // Dados pessoais
                name: contact.name || answers.contact?.name || 'Cliente',
                email: contact.email || answers.contact?.email || '',
                phone: contact.phone || answers.contact?.phone || '',
                
                // Dados do quiz
                goal: answers.goal || 'lose_weight',
                gender: answers.gender || 'female',
                age: answers.age || '26-35',
                activity: answers.activity || 'moderate',
                diet: answers.diet || 'no_restrictions',
                
                // ‚úÖ DADOS F√çSICOS - ESTRUTURA CORRETA DA P√ÅGINA INDEX
                weight: parseFloat(physical.weight) || 70,
                height: parseFloat(physical.height) || 170,
                targetWeight: parseFloat(physical.target_weight) || 65,
                
                // Arrays (podem estar vazios)
                health: Array.isArray(answers.health) ? answers.health : ['healthy'],
                allergies: Array.isArray(answers.allergies) ? answers.allergies : ['no_allergies'],
                
                // Metadados
                dataSource: quizData.source,
                hasRealData: true
            };
            
            console.log('‚úÖ Dados processados com sucesso:', processedData);
            
            // ‚úÖ VALIDA√á√ÉO ADICIONAL
            if (processedData.weight < 30 || processedData.weight > 300) {
                console.warn('‚ö†Ô∏è Peso inv√°lido detectado, usando valor padr√£o');
                processedData.weight = 70;
                processedData.hasRealData = false;
            }
            
            if (processedData.height < 100 || processedData.height > 250) {
                console.warn('‚ö†Ô∏è Altura inv√°lida detectada, usando valor padr√£o');
                processedData.height = 170;
                processedData.hasRealData = false;
            }
            
            return processedData;
        }

        // ‚úÖ FUN√á√ÉO PARA CALCULAR NUTRI√á√ÉO (usando dados corrigidos)
        function calculateNutritionFromQuiz(userData) {
            console.log('üßÆ Calculando nutri√ß√£o para:', userData);
            
            const weight = userData.weight;
            const height = userData.height;
            const goal = userData.goal;
            const activity = userData.activity;
            const gender = userData.gender;
            
            // ‚úÖ C√ÅLCULOS IGUAIS AOS DA P√ÅGINA INDEX
            const ageRanges = {
                '18-25': 21.5,
                '26-35': 30.5,
                '36-45': 40.5,
                '46-55': 50.5,
                '55+': 60
            };
            const ageValue = ageRanges[userData.age] || 30;
            
            // Calcular TMB (mesma f√≥rmula da p√°gina index)
            let bmr;
            if (gender === 'male') {
                bmr = 10 * weight + 6.25 * height - 5 * ageValue + 5;
            } else {
                bmr = 10 * weight + 6.25 * height - 5 * ageValue - 161;
            }
            
            // Multiplicadores de atividade (iguais √† p√°gina index)
            const activityMultipliers = {
                sedentary: 1.2,
                light: 1.375,
                moderate: 1.55,
                intense: 1.725
            };
            
            const tdee = Math.round(bmr * (activityMultipliers[activity] || 1.55));
            
            // Ajustar calorias baseado no objetivo (igual √† p√°gina index)
            let calories;
            switch(goal) {
                case 'lose_weight':
                    calories = Math.round(tdee - 500);
                    break;
                case 'gain_muscle':
                    calories = Math.round(tdee + 300);
                    break;
                default:
                    calories = Math.round(tdee);
            }
            
            // Calcular macronutrientes (igual √† p√°gina index)
            const protein = Math.round(weight * 2.2);
            const fats = Math.round(calories * 0.3 / 9);
            const carbs = Math.round((calories - (protein * 4) - (fats * 9)) / 4);
            
            const result = { 
                calories, 
                protein, 
                carbs, 
                fats,
                bmr: Math.round(bmr),
                tdee: tdee
            };
            
            console.log('‚úÖ Nutri√ß√£o calculada:', result);
            return result;
        }

        // ‚úÖ FUN√á√ÉO MELHORADA PARA MOSTRAR STATUS DOS DADOS
        function showDataStatus(userData, hasRealData) {
            // Remover status anterior se existir
            const existingStatus = document.getElementById('dataStatus');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            const statusDiv = document.createElement('div');
            statusDiv.id = 'dataStatus';
            statusDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 12px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                max-width: 350px;
                font-size: 14px;
                backdrop-filter: blur(10px);
                border: 2px solid;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            `;
            
            if (hasRealData) {
                statusDiv.style.background = 'linear-gradient(135deg, rgba(40, 167, 69, 0.9), rgba(32, 201, 151, 0.9))';
                statusDiv.style.borderColor = '#28a745';
                statusDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <span style="font-size: 20px;">‚úÖ</span>
                        <strong>Dieta Econ√¥mica Gerada!</strong>
                    </div>
                    <div style="font-size: 12px; opacity: 0.9; margin-bottom: 8px;">
                        Plano com alimentos baratos para <strong>${userData.name}</strong>
                    </div>
                    <div style="font-size: 11px; opacity: 0.8;">
                        üí∞ Foco em economia ‚Ä¢ ${userData.weight}kg ‚Ä¢ ${translations.goal[userData.goal] || userData.goal}
                    </div>
                `;
                
                // Remover ap√≥s 5 segundos
                setTimeout(() => {
                    statusDiv.style.opacity = '0';
                    statusDiv.style.transform = 'translateX(100%)';
                    setTimeout(() => statusDiv.remove(), 500);
                }, 5000);
                
            } else {
                statusDiv.style.background = 'linear-gradient(135deg, rgba(255, 107, 53, 0.9), rgba(247, 147, 30, 0.9))';
                statusDiv.style.borderColor = '#ff6b35';
                statusDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <span style="font-size: 20px;">‚ö†Ô∏è</span>
                        <strong>Usando Dieta Demonstra√ß√£o</strong>
                    </div>
                    <div style="font-size: 12px; opacity: 0.9; margin-bottom: 10px;">
                        Para sua dieta econ√¥mica personalizada, refa√ßa o quiz
                    </div>
                    <button onclick="window.location.href='index.html'" style="
                        background: white;
                        color: #ff6b35;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: bold;
                        font-size: 12px;
                        width: 100%;
                    ">üîÑ Refazer Quiz Personalizado</button>
                `;
            }
            
            document.body.appendChild(statusDiv);
        }

        // ‚úÖ FUN√á√ÉO PARA ADICIONAR AVISO DE DEMONSTRA√á√ÉO NA INTERFACE
        function addDemoWarningToInterface() {
            const welcomeCard = document.querySelector('.welcome-card');
            if (welcomeCard && !document.getElementById('demoWarning')) {
                const demoWarning = document.createElement('div');
                demoWarning.id = 'demoWarning';
                demoWarning.style.cssText = `
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.15), rgba(247, 147, 30, 0.15));
                    border: 2px solid rgba(255, 107, 53, 0.4);
                    border-radius: 16px;
                    padding: 25px;
                    margin-top: 25px;
                    text-align: center;
                    position: relative;
                    overflow: hidden;
                `;
                
                demoWarning.innerHTML = `
                    <div style="font-size: 24px; margin-bottom: 12px;">‚ö†Ô∏è</div>
                    <h4 style="color: #ff6b35; margin-bottom: 12px; font-size: 18px; font-weight: 800;">
                        Dieta de Demonstra√ß√£o
                    </h4>
                    <p style="color: rgba(255, 255, 255, 0.9); font-size: 14px; line-height: 1.5; margin-bottom: 15px;">
                        Esta √© uma pr√©via com alimentos econ√¥micos gen√©ricos. Para sua dieta verdadeiramente personalizada com ingredientes baratos espec√≠ficos para voc√™, refa√ßa o quiz completo.
                    </p>
                    <button onclick="window.location.href='index.html'" style="
                        background: linear-gradient(135deg, #ff6b35, #f7931e);
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 10px;
                        cursor: pointer;
                        font-weight: bold;
                        font-size: 14px;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        üöÄ Fazer Minha Avalia√ß√£o Econ√¥mica
                    </button>
                `;
                
                welcomeCard.appendChild(demoWarning);
            }
        }

        // ‚úÖ FUN√á√ÉO PRINCIPAL CORRIGIDA PARA CARREGAR DADOS
        function loadUserData() {
            console.log('üöÄ Carregando dados do usu√°rio - vers√£o econ√¥mica...');
            
            try {
                // ‚úÖ 1. LER DADOS DO LOCAL CORRETO
                const quizData = getQuizData();
                console.log('üìÑ Dados brutos recuperados:', quizData);
                
                // ‚úÖ 2. PROCESSAR DADOS COM ESTRUTURA CORRETA
                const userData = processUserData(quizData);
                console.log('üë§ Dados do usu√°rio processados:', userData);
                
                // ‚úÖ 3. CALCULAR NUTRI√á√ÉO BASEADA NOS DADOS REAIS
                const nutrition = calculateNutritionFromQuiz(userData);
                console.log('üßÆ Nutri√ß√£o calculada:', nutrition);
                
                // ‚úÖ 4. VERIFICAR SE TEMOS DADOS REAIS OU ESTAMOS USANDO DEFAULTS
                const hasRealData = quizData.hasData && userData.hasRealData;
                console.log('üîç Usando dados reais?', hasRealData);
                
                // ‚úÖ 5. MOSTRAR STATUS NA INTERFACE
                showDataStatus(userData, hasRealData);
                
                // ‚úÖ 6. ATUALIZAR INTERFACE COM DADOS PERSONALIZADOS
                updateUserInterface(userData, nutrition);
                
                // ‚úÖ 7. SALVAR DADOS GLOBALMENTE PARA USO NO PDF
                window.currentUserData = userData;
                window.currentNutrition = nutrition;
                window.hasRealData = hasRealData;
                window.dataSource = quizData.source;
                
                // ‚úÖ 8. LOG COMPLETO PARA DEBUG
                console.log('üìä RESUMO FINAL DA CARGA DE DADOS ECON√îMICOS:');
                console.log('‚îå‚îÄ Fonte dos dados:', quizData.source);
                console.log('‚îú‚îÄ Dados v√°lidos:', hasRealData);
                console.log('‚îú‚îÄ Nome:', userData.name);
                console.log('‚îú‚îÄ Objetivo:', userData.goal);
                console.log('‚îú‚îÄ Peso:', userData.weight + 'kg');
                console.log('‚îú‚îÄ Altura:', userData.height + 'cm');
                console.log('‚îú‚îÄ Calorias meta:', nutrition.calories);
                console.log('‚îú‚îÄ Prote√≠nas:', nutrition.protein + 'g');
                console.log('‚îú‚îÄ Carboidratos:', nutrition.carbs + 'g');
                console.log('‚îî‚îÄ Gorduras:', nutrition.fats + 'g');
                
                // ‚úÖ 9. ADICIONAR INFORMA√á√ïES EXTRAS SE N√ÉO TEMOS DADOS REAIS
                if (!hasRealData) {
                    addDemoWarningToInterface();
                    console.log('‚ö†Ô∏è Usando dados de demonstra√ß√£o econ√¥mica - usu√°rio deve refazer quiz');
                } else {
                    console.log('‚úÖ Sistema econ√¥mico funcionando perfeitamente com dados reais!');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
                
                // Fallback para dados padr√£o
                const userData = { ...defaultUserData, dataSource: 'error_fallback' };
                const nutrition = calculateNutritionFromQuiz(userData);
                
                updateUserInterface(userData, nutrition);
                showDataStatus(userData, false);
                addDemoWarningToInterface();
                
                window.currentUserData = userData;
                window.currentNutrition = nutrition;
                window.hasRealData = false;
                
                console.log('üîÑ Fallback aplicado - usando dados padr√£o econ√¥micos');
            }
        }

        // Fun√ß√£o para gerar mensagem personalizada baseada no objetivo (vers√£o econ√¥mica)
        function getPersonalizedMessage(userData) {
            const { goal, weight, targetWeight, health, allergies } = userData;
            
            let message = "";
            
            switch(goal) {
                case 'lose_weight':
                    const weightToLose = weight - targetWeight;
                    message = `Seu protocolo econ√¥mico foi desenvolvido para eliminar ${weightToLose}kg usando alimentos b√°sicos e acess√≠veis. `;
                    break;
                case 'gain_muscle':
                    message = "Seu protocolo econ√¥mico foi desenvolvido para ganho de massa muscular com ingredientes baratos e nutritivos. ";
                    break;
                case 'maintain':
                    message = "Seu protocolo econ√¥mico foi desenvolvido para manuten√ß√£o do peso com foco em economia. ";
                    break;
                case 'health':
                    message = "Seu protocolo econ√¥mico foi desenvolvido para melhorar a sa√∫de sem gastar muito. ";
                    break;
            }
            
            // Adicionar informa√ß√µes sobre condi√ß√µes de sa√∫de
            if (health && health.length > 0 && !health.includes('healthy')) {
                message += "Consideramos suas condi√ß√µes de sa√∫de usando apenas ingredientes acess√≠veis. ";
            }
            
            // Adicionar informa√ß√µes sobre alergias
            if (allergies && allergies.length > 0 && !allergies.includes('no_allergies')) {
                message += "Todas as suas restri√ß√µes foram respeitadas com substitutos econ√¥micos. ";
            }
            
            return message;
        }

        // Fun√ß√£o para atualizar a interface (vers√£o econ√¥mica)
        function updateUserInterface(userData, nutrition) {
            // Nome do usu√°rio
            const firstName = userData.name.split(' ')[0];
            document.getElementById('userName').textContent = `Ol√°, ${firstName}!`;
            
            // Perfil do usu√°rio
            document.getElementById('userGoal').textContent = translations.goal[userData.goal] || 'Objetivo n√£o definido';
            document.getElementById('userWeight').textContent = userData.weight + 'kg';
            document.getElementById('userHeight').textContent = userData.height + 'cm';
            document.getElementById('userAge').textContent = translations.age[userData.age] || userData.age;
            document.getElementById('userActivity').textContent = translations.activity[userData.activity] || 'N√£o definido';
            document.getElementById('userDiet').textContent = translations.diet[userData.diet] || 'Alimentos Econ√¥micos';
            
            // Metas nutricionais
            document.getElementById('targetCalories').textContent = nutrition.calories;
            document.getElementById('targetProtein').textContent = nutrition.protein + 'g';
            document.getElementById('targetCarbs').textContent = nutrition.carbs + 'g';
            document.getElementById('targetFats').textContent = nutrition.fats + 'g';
            
            // Atualizar subt√≠tulo com mensagem personalizada econ√¥mica
            const welcomeCard = document.querySelector('.welcome-card p');
            if (welcomeCard) {
                const personalizedMessage = getPersonalizedMessage(userData);
                welcomeCard.innerHTML = personalizedMessage + 'Baseado em evid√™ncias cient√≠ficas e adaptado especialmente para seu or√ßamento e objetivos.';
            }
            
            // Adicionar informa√ß√µes de sa√∫de se houver
            addHealthInformation(userData);
        }

        // Fun√ß√£o para adicionar informa√ß√µes de sa√∫de
        function addHealthInformation(userData) {
            const profileGrid = document.getElementById('profileGrid');
            
            // Adicionar condi√ß√µes de sa√∫de se houver
            if (userData.health && userData.health.length > 0 && !userData.health.includes('healthy')) {
                const healthItem = document.createElement('div');
                healthItem.className = 'profile-item';
                healthItem.innerHTML = `
                    <div class="profile-icon">üè•</div>
                    <div>
                        <strong>Condi√ß√µes:</strong><br>
                        <span>${userData.health.map(h => translations.health[h] || h).join(', ')}</span>
                    </div>
                `;
                profileGrid.appendChild(healthItem);
            }
            
            // Adicionar alergias se houver
            if (userData.allergies && userData.allergies.length > 0 && !userData.allergies.includes('no_allergies')) {
                const allergyItem = document.createElement('div');
                allergyItem.className = 'profile-item';
                allergyItem.innerHTML = `
                    <div class="profile-icon">‚ö†Ô∏è</div>
                    <div>
                        <strong>Restri√ß√µes:</strong><br>
                        <span>${userData.allergies.map(a => translations.allergies[a] || a).join(', ')}</span>
                    </div>
                `;
                profileGrid.appendChild(allergyItem);
            }
        }

        // ‚úÖ FUN√á√ÉO DE GERA√á√ÉO DE PDF ATUALIZADA COM FOCO EM ECONOMIA
        function generateDietaPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const userData = window.currentUserData || defaultUserData;
            const nutrition = window.currentNutrition || { calories: 1500, protein: 120, carbs: 150, fats: 50 };
            
            // Detectar alergias/intoler√¢ncias para adaptar receitas econ√¥micas
            const hasLactoseIntolerance = userData.allergies && userData.allergies.includes('lactose');
            const hasGlutenIntolerance = userData.allergies && userData.allergies.includes('gluten');
            const hasNutsAllergy = userData.allergies && userData.allergies.includes('nuts');
            const hasSeafoodAllergy = userData.allergies && userData.allergies.includes('seafood');
            
            // Detectar condi√ß√µes de sa√∫de para orienta√ß√µes espec√≠ficas
            const hasDiabetes = userData.health && userData.health.includes('diabetes');
            const hasHypertension = userData.health && userData.health.includes('hypertension');
            const hasHeartProblems = userData.health && userData.health.includes('heart');
            
            let pageCount = 1;
            
            // =================== CAPA ECON√îMICA ===================
            doc.setFillColor(40, 167, 69);
            doc.rect(0, 0, 210, 297, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(28);
            doc.text('DIETA ECON√îMICA', 105, 60, { align: 'center' });
            doc.setFontSize(24);
            doc.text('PERSONALIZADA', 105, 80, { align: 'center' });
            
            doc.setFontSize(16);
            doc.text('Protocolo Nutricional com Alimentos Baratos', 105, 100, { align: 'center' });
            
            doc.setFontSize(26);
            doc.text(userData.name, 105, 130, { align: 'center' });
            
            doc.setFontSize(16);
            doc.text(`Objetivo: ${translations.goal[userData.goal] || userData.goal}`, 105, 150, { align: 'center' });
            doc.text(`${nutrition.calories} calorias di√°rias`, 105, 170, { align: 'center' });
            
            // Destaque econ√¥mico
            doc.setFontSize(14);
            doc.text('üí∞ FOCO EM ECONOMIA E NUTRI√á√ÉO üí∞', 105, 190, { align: 'center' });
            
            doc.setFontSize(12);
            doc.text('Dra. Giovana Nutricionista', 105, 220, { align: 'center' });
            doc.text('CRN: 3 87654 | Especialista em Nutri√ß√£o Econ√¥mica', 105, 235, { align: 'center' });
            
            const today = new Date().toLocaleDateString('pt-BR');
            doc.text('Data: ' + today, 105, 260, { align: 'center' });
            
            // =================== P√ÅGINA 2 - AVALIA√á√ÉO ECON√îMICA ===================
            doc.addPage();
            pageCount++;
            
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(22);
            doc.setTextColor(40, 167, 69);
            doc.text('SUA AVALIA√á√ÉO NUTRICIONAL ECON√îMICA', 20, 25);
            
            doc.setDrawColor(40, 167, 69);
            doc.setLineWidth(2);
            doc.line(20, 30, 190, 30);
            
            let yPos = 45;
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text('DADOS PESSOAIS', 20, yPos);
            yPos += 15;
            
            doc.setFontSize(11);
            const dadosUsuario = [
                ['Nome:', userData.name],
                ['Objetivo:', translations.goal[userData.goal] || userData.goal],
                ['Peso Atual:', userData.weight + 'kg'],
                ['Altura:', userData.height + 'cm'],
                ['Faixa Et√°ria:', translations.age[userData.age] || userData.age],
                ['N√≠vel de Atividade:', translations.activity[userData.activity] || userData.activity],
                ['Foco:', 'Alimentos Econ√¥micos e Nutritivos']
            ];
            
            dadosUsuario.forEach(([label, value]) => {
                doc.text(label, 25, yPos);
                doc.text(value, 80, yPos);
                yPos += 8;
            });
            
            // Destaque econ√¥mico
            yPos += 10;
            doc.setFontSize(12);
            doc.setTextColor(40, 167, 69);
            doc.text('FILOSOFIA ECON√îMICA:', 25, yPos);
            yPos += 8;
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.text('Esta dieta prioriza ingredientes b√°sicos, acess√≠veis e nutritivos', 30, yPos);
            yPos += 6;
            doc.text('que cabem no or√ßamento familiar brasileiro.', 30, yPos);
            yPos += 15;
            
            // Condi√ß√µes de sa√∫de
            if (userData.health && userData.health.length > 0 && !userData.health.includes('healthy')) {
                doc.setFontSize(12);
                doc.setTextColor(40, 167, 69);
                doc.text('CONDI√á√ïES DE SA√öDE (com solu√ß√µes econ√¥micas):', 25, yPos);
                yPos += 8;
                doc.setFontSize(11);
                doc.setTextColor(0, 0, 0);
                userData.health.forEach(condition => {
                    doc.text('‚Ä¢ ' + (translations.health[condition] || condition), 30, yPos);
                    yPos += 7;
                });
            }
            
            // Alergias/Intoler√¢ncias
            if (userData.allergies && userData.allergies.length > 0 && !userData.allergies.includes('no_allergies')) {
                yPos += 10;
                doc.setFontSize(12);
                doc.setTextColor(40, 167, 69);
                doc.text('RESTRI√á√ïES ALIMENTARES (com substitutos baratos):', 25, yPos);
                yPos += 8;
                doc.setFontSize(11);
                doc.setTextColor(0, 0, 0);
                userData.allergies.forEach(allergy => {
                    doc.text('‚Ä¢ ' + (translations.allergies[allergy] || allergy), 30, yPos);
                    yPos += 7;
                });
            }
            
            // C√°lculos
            yPos += 15;
            doc.setFontSize(14);
            doc.setTextColor(40, 167, 69);
            doc.text('SEUS N√öMEROS', 20, yPos);
            yPos += 12;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            
            const imc = (userData.weight / ((userData.height/100) * (userData.height/100))).toFixed(1);
            let imcClass = '';
            if (imc < 18.5) imcClass = 'Abaixo do peso';
            else if (imc < 25) imcClass = 'Peso normal';
            else if (imc < 30) imcClass = 'Sobrepeso';
            else imcClass = 'Obesidade';
            
            const calculos = [
                ['IMC:', `${imc} kg/m¬≤ (${imcClass})`],
                ['TMB (metabolismo basal):', `${nutrition.bmr || 'N/A'} calorias/dia`],
                ['Calorias meta di√°rias:', `${nutrition.calories} calorias`],
                ['Prote√≠nas di√°rias:', `${nutrition.protein}g`],
                ['Carboidratos di√°rios:', `${nutrition.carbs}g`],
                ['Gorduras di√°rias:', `${nutrition.fats}g`]
            ];
            
            calculos.forEach(([label, value]) => {
                doc.text(label, 25, yPos);
                doc.text(value, 100, yPos);
                yPos += 8;
            });
            
            // =================== P√ÅGINA 3 - CARD√ÅPIO ECON√îMICO 7 DIAS ===================
            doc.addPage();
            pageCount++;
            
            doc.setFontSize(22);
            doc.setTextColor(40, 167, 69);
            doc.text('CARD√ÅPIO ECON√îMICO - 7 DIAS', 20, 25);
            
            doc.setDrawColor(40, 167, 69);
            doc.setLineWidth(2);
            doc.line(20, 30, 190, 30);
            
            yPos = 45;
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            
            // ‚úÖ CARD√ÅPIO ECON√îMICO ADAPTADO √ÄS RESTRI√á√ïES
            const cardapioEconomico = [
                {
                    dia: 'SEGUNDA-FEIRA',
                    cafe: hasLactoseIntolerance ? 'Ovo mexido + P√£o franc√™s + Caf√© com a√ß√∫car' : 'Ovo mexido + P√£o franc√™s + Leite com achocolatado',
                    lanche1: hasNutsAllergy ? 'Banana + Biscoito √°gua e sal' : 'Banana + 3 castanhas-do-par√°',
                    almoco: 'Frango cozido + Arroz branco + Feij√£o carioca + Salada de alface',
                    lanche2: hasLactoseIntolerance ? 'P√£o com margarina + Suco de lim√£o' : 'P√£o com requeij√£o + Suco de lim√£o',
                    jantar: 'Ovo cozido + Batata cozida + Cenoura refogada'
                },
                {
                    dia: 'TER√áA-FEIRA', 
                    cafe: hasGlutenIntolerance ? 'Mingau de fub√° + Banana' : 'P√£o franc√™s + Margarina + Caf√© doce',
                    lanche1: 'Ma√ß√£ + Bolacha maisena',
                    almoco: 'Carne mo√≠da + Macarr√£o comum + Molho de tomate + Couve refogada',
                    lanche2: hasLactoseIntolerance ? 'Vitamina de banana com √°gua' : 'Vitamina de banana com leite',
                    jantar: 'Sardinha + Arroz branco + Ab√≥bora cozida'
                },
                {
                    dia: 'QUARTA-FEIRA',
                    cafe: hasLactoseIntolerance ? 'Mingau de aveia com √°gua + A√ß√∫car' : 'Mingau de aveia + Leite + A√ß√∫car',
                    lanche1: 'Laranja + P√£o franc√™s',
                    almoco: 'F√≠gado de frango + Arroz + Feij√£o + Salada de tomate',
                    lanche2: 'Batata doce cozida + Caf√©',
                    jantar: hasSeafoodAllergy ? 'Ovo mexido + Farinha de mandioca + Banana' : 'Peixe cozido + Pur√™ de batata'
                },
                {
                    dia: 'QUINTA-FEIRA',
                    cafe: hasGlutenIntolerance ? 'Tapioca simples + Ovo' : 'P√£o franc√™s + Ovo mexido + Caf√©',
                    lanche1: 'Mam√£o + Biscoito cream cracker',
                    almoco: 'Frango cozido + Macarr√£o + Feij√£o + Acelga refogada',
                    lanche2: hasLactoseIntolerance ? 'Suco de goiaba + P√£o' : 'Iogurte natural + A√ß√∫car',
                    jantar: 'Carne mo√≠da + Polenta + Salada de repolho'
                },
                {
                    dia: 'SEXTA-FEIRA',
                    cafe: hasLactoseIntolerance ? 'Cuscuz + Margarina' : 'Cuscuz + Leite + A√ß√∫car',
                    lanche1: 'Banana + √Ågua',
                    almoco: hasSeafoodAllergy ? 'Frango + Lentilha + Arroz + Couve' : 'Peixe + Lentilha + Arroz + Couve',
                    lanche2: 'P√£o franc√™s + Margarina',
                    jantar: 'Omelete simples + Batata cozida + Salada'
                },
                {
                    dia: 'S√ÅBADO',
                    cafe: hasGlutenIntolerance ? 'Mingau de milho + Banana' : 'P√£o franc√™s + Margarina + Caf√©',
                    lanche1: 'Goiaba + Biscoito',
                    almoco: 'Carne de panela + Arroz + Feij√£o + Ab√≥bora',
                    lanche2: hasLactoseIntolerance ? 'Suco de lim√£o + P√£o' : 'Leite + Bolacha maria',
                    jantar: 'Sardinha + Farofa de farinha + Salada'
                },
                {
                    dia: 'DOMINGO',
                    cafe: 'Ovos mexidos + P√£o franc√™s + Caf√© doce',
                    lanche1: 'Laranja + Biscoito √°gua e sal',
                    almoco: 'Frango assado + Arroz + Feij√£o + Salada de alface e tomate',
                    lanche2: 'Vitamina de banana',
                    jantar: hasSeafoodAllergy ? 'Ovo cozido + Batata + Cenoura' : 'Peixe + Pur√™ de batata + Cenoura'
                }
            ];
            
            cardapioEconomico.forEach(refeicao => {
                if (yPos > 260) {
                    doc.addPage();
                    pageCount++;
                    yPos = 30;
                }
                
                doc.setFontSize(12);
                doc.setTextColor(40, 167, 69);
                doc.text(refeicao.dia, 20, yPos);
                yPos += 10;
                
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                
                const refeicoes = [
                    ['‚òÄÔ∏è Caf√© da manh√£:', refeicao.cafe],
                    ['üçé Lanche da manh√£:', refeicao.lanche1],
                    ['üçΩÔ∏è Almo√ßo:', refeicao.almoco],
                    ['ü•§ Lanche da tarde:', refeicao.lanche2],
                    ['üåô Jantar:', refeicao.jantar]
                ];
                
                refeicoes.forEach(([tipo, comida]) => {
                    doc.text(tipo, 25, yPos);
                    yPos += 5;
                    // Quebrar linha se a comida for muito longa
                    const palavras = comida.split(' ');
                    let linha = '';
                    palavras.forEach(palavra => {
                        if (linha.length + palavra.length > 45) {
                            doc.text(linha, 25, yPos);
                            yPos += 4;
                            linha = palavra + ' ';
                        } else {
                            linha += palavra + ' ';
                        }
                    });
                    if (linha.trim()) {
                        doc.text(linha, 25, yPos);
                        yPos += 6;
                    }
                });
                yPos += 8;
            });
            
            // =================== P√ÅGINA RECEITAS ECON√îMICAS ===================
            doc.addPage();
            pageCount++;
            
            doc.setFontSize(22);
            doc.setTextColor(40, 167, 69);
            doc.text('RECEITAS ECON√îMICAS', 20, 25);
            
            doc.setDrawColor(40, 167, 69);
            doc.setLineWidth(2);
            doc.line(20, 30, 190, 30);
            
            yPos = 45;
            
            // ‚úÖ RECEITAS ECON√îMICAS ADAPTADAS √ÄS RESTRI√á√ïES
            const receitasEconomicas = [
                {
                    nome: hasLactoseIntolerance ? 'Omelete Simples Econ√¥mica' : 'Omelete com Leite',
                    categoria: 'Caf√© da Manh√£',
                    tempo: '10 min',
                    calorias: '220 cal',
                    custo: 'R$ 1,50',
                    ingredientes: hasLactoseIntolerance ? [
                        '2 ovos',
                        '1 col. sopa √≥leo',
                        '1 pitada sal',
                        '1 fatia p√£o franc√™s',
                        'Tempero verde (opcional)'
                    ] : [
                        '2 ovos',
                        '2 col. sopa leite',
                        '1 col. ch√° √≥leo',
                        '1 pitada sal',
                        '1 fatia p√£o franc√™s'
                    ],
                    preparo: [
                        'Bata os ovos com sal',
                        'Adicione o leite ou tempero verde',
                        'Aque√ßa o √≥leo na frigideira',
                        'Despeje os ovos batidos',
                        'Cozinhe em fogo baixo por 3-4 min',
                        'Dobre ao meio e sirva com p√£o'
                    ]
                },
                {
                    nome: hasGlutenIntolerance ? 'Mingau de Fub√° Doce' : 'P√£o Caseiro Simples',
                    categoria: 'Caf√© da Manh√£',
                    tempo: hasGlutenIntolerance ? '15 min' : '3 horas',
                    calorias: hasGlutenIntolerance ? '180 cal' : '250 cal',
                    custo: hasGlutenIntolerance ? 'R$ 0,80' : 'R$ 2,00',
                    ingredientes: hasGlutenIntolerance ? [
                        '3 col. sopa fub√°',
                        '1 x√≠cara √°gua',
                        '2 col. sopa a√ß√∫car',
                        '1 pitada sal',
                        '1 col. ch√° margarina'
                    ] : [
                        '500g farinha de trigo',
                        '1 sach√™ fermento biol√≥gico',
                        '1 col. sopa a√ß√∫car',
                        '1 col. ch√° sal',
                        '300ml √°gua morna'
                    ],
                    preparo: hasGlutenIntolerance ? [
                        'Ferva a √°gua com sal',
                        'Adicione o fub√° mexendo sempre',
                        'Cozinhe por 10 minutos mexendo',
                        'Adicione a√ß√∫car e margarina',
                        'Sirva quente'
                    ] : [
                        'Misture fermento, a√ß√∫car e √°gua morna',
                        'Adicione farinha e sal aos poucos',
                        'Sove por 10 minutos',
                        'Deixe crescer por 1 hora',
                        'Modele os p√£es e deixe crescer mais 1 hora',
                        'Asse por 30 min a 180¬∞C'
                    ]
                },
                {
                    nome: hasSeafoodAllergy ? 'Frango Cozido Temperado' : 'Sardinha Refogada',
                    categoria: 'Almo√ßo/Jantar',
                    tempo: hasSeafoodAllergy ? '40 min' : '15 min',
                    calorias: hasSeafoodAllergy ? '280 cal' : '200 cal',
                    custo: hasSeafoodAllergy ? 'R$ 3,50' : 'R$ 2,00',
                    ingredientes: hasSeafoodAllergy ? [
                        '200g frango (coxa ou sobrecoxa)',
                        '2 dentes alho',
                        '1 cebola pequena',
                        '1 col. sopa √≥leo',
                        'Sal, pimenta, colorau',
                        '1 tomate pequeno'
                    ] : [
                        '1 lata sardinha',
                        '1 cebola m√©dia',
                        '2 dentes alho',
                        '1 col. sopa √≥leo',
                        '1 tomate',
                        'Sal, pimenta, cheiro verde'
                    ],
                    preparo: hasSeafoodAllergy ? [
                        'Tempere o frango com sal e alho',
                        'Doure em √≥leo quente',
                        'Adicione cebola e tomate picados',
                        'Cubra com √°gua e cozinhe por 30 min',
                        'Tempere com colorau e pimenta',
                        'Sirva com arroz e feij√£o'
                    ] : [
                        'Refogue alho e cebola no √≥leo',
                        'Adicione tomate picado',
                        'Acrescente a sardinha escorrida',
                        'Tempere com sal e pimenta',
                        'Cozinhe por 5 minutos',
                        'Finalize com cheiro verde'
                    ]
                }
            ];
            
            receitasEconomicas.forEach(receita => {
                if (yPos > 220) {
                    doc.addPage();
                    pageCount++;
                    yPos = 30;
                }
                
                // T√≠tulo da receita
                doc.setFontSize(14);
                doc.setTextColor(40, 167, 69);
                doc.text(receita.nome, 20, yPos);
                yPos += 8;
                
                // Info da receita
                doc.setFontSize(9);
                doc.setTextColor(100, 100, 100);
                doc.text(`${receita.categoria} | ${receita.tempo} | ${receita.calorias} | Custo: ${receita.custo}`, 20, yPos);
                yPos += 12;
                
                // Ingredientes
                doc.setFontSize(11);
                doc.setTextColor(0, 0, 0);
                doc.text('INGREDIENTES:', 20, yPos);
                yPos += 7;
                
                doc.setFontSize(9);
                receita.ingredientes.forEach(ingrediente => {
                    doc.text('‚Ä¢ ' + ingrediente, 25, yPos);
                    yPos += 5;
                });
                yPos += 5;
                
                // Preparo
                doc.setFontSize(11);
                doc.text('MODO DE PREPARO:', 20, yPos);
                yPos += 7;
                
                doc.setFontSize(9);
                receita.preparo.forEach((passo, index) => {
                    doc.text(`${index + 1}. ${passo}`, 25, yPos);
                    yPos += 5;
                });
                yPos += 15;
            });
            
            // =================== P√ÅGINA LISTAS DE ALIMENTOS ECON√îMICOS ===================
            doc.addPage();
            pageCount++;
            
            doc.setFontSize(22);
            doc.setTextColor(40, 167, 69);
            doc.text('LISTA DE COMPRAS ECON√îMICA', 20, 25);
            
            doc.setDrawColor(40, 167, 69);
            doc.setLineWidth(2);
            doc.line(20, 30, 190, 30);
            
            yPos = 45;
            
            // ‚úÖ LISTAS ECON√îMICAS ADAPTADAS √ÄS RESTRI√á√ïES
            const listasEconomicas = [
                {
                    categoria: 'PROTE√çNAS BARATAS ‚úÖ',
                    permitidos: hasSeafoodAllergy ? [
                        'Ovos (bandeja com 30)',
                        'Frango (coxa e sobrecoxa)', 
                        'Carne mo√≠da comum',
                        'F√≠gado de frango',
                        'Sardinha enlatada',
                        'Feij√£o carioca',
                        'Lentilha'
                    ] : [
                        'Ovos (bandeja com 30)',
                        'Frango (coxa e sobrecoxa)',
                        'Carne mo√≠da comum', 
                        'Peixe (til√°pia, sardinha)',
                        'F√≠gado de frango',
                        'Feij√£o carioca',
                        'Lentilha'
                    ],
                    evitar: [
                        'Carnes nobres (picanha, alcatra)',
                        'Salm√£o e peixes importados',
                        'Camar√£o e frutos do mar caros',
                        'Whey protein e suplementos'
                    ]
                },
                {
                    categoria: 'CARBOIDRATOS EM CONTA ‚úÖ',
                    permitidos: hasGlutenIntolerance ? [
                        'Arroz branco (saco 5kg)',
                        'Batata comum',
                        'Batata doce',
                        'Mandioca/Aipim',
                        'Fub√° de milho',
                        'Tapioca/Goma',
                        'Banana'
                    ] : [
                        'Arroz branco (saco 5kg)',
                        'Macarr√£o comum',
                        'P√£o franc√™s',
                        'Farinha de trigo',
                        'Batata comum',
                        'Aveia em flocos',
                        'Banana'
                    ],
                    evitar: hasGlutenIntolerance ? [
                        'Trigo e derivados',
                        'P√£es especiais',
                        'Massas importadas',
                        'Quinoa e gr√£os caros'
                    ] : [
                        'Quinoa e gr√£os importados',
                        'P√£es especiais/integrais caros',
                        'Massas premium',
                        'Cereais matinais industrializados'
                    ]
                }
            ];
            
            if (hasLactoseIntolerance) {
                listasEconomicas.push({
                    categoria: 'SUBSTITUTOS L√ÅCTEOS BARATOS ‚úÖ',
                    permitidos: [
                        'Leite de soja em p√≥',
                        'Margarina comum',
                        'Creme vegetal',
                        'Achocolatado em p√≥',
                        'Leite condensado de soja'
                    ],
                    evitar: [
                        'Leite de vaca',
                        'Queijos',
                        'Iogurtes',
                        'Manteiga',
                        'Creme de leite'
                    ]
                });
            }
            
            // Adicionar lista de temperos econ√¥micos
            listasEconomicas.push({
                categoria: 'TEMPEROS E B√ÅSICOS üßÑ',
                permitidos: [
                    'Alho (saco 1kg)',
                    'Cebola (saco 2kg)',
                    'Sal refinado',
                    '√ìleo de soja',
                    'A√ß√∫car cristal',
                    'Colorau/Urucum',
                    'Cheiro verde'
                ],
                evitar: [
                    'Temperos importados',
                    'Azeite extra virgem caro',
                    'Sal rosa/especiais',
                    'A√ß√∫car org√¢nico',
                    'Especiarias raras'
                ]
            });
            
            listasEconomicas.forEach(lista => {
                if (yPos > 200) {
                    doc.addPage();
                    pageCount++;
                    yPos = 30;
                }
                
                doc.setFontSize(12);
                doc.setTextColor(40, 167, 69);
                doc.text(lista.categoria, 20, yPos);
                yPos += 10;
                
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                
                lista.permitidos.forEach(item => {
                    doc.text('‚úÖ ' + item, 25, yPos);
                    yPos += 5;
                });
                
                yPos += 5;
                doc.setTextColor(200, 0, 0);
                doc.text('EVITAR (muito caro):', 25, yPos);
                yPos += 6;
                
                lista.evitar.forEach(item => {
                    doc.text('‚ùå ' + item, 25, yPos);
                    yPos += 5;
                });
                
                yPos += 15;
                doc.setTextColor(0, 0, 0);
            });
            
            // =================== P√ÅGINA DICAS DE ECONOMIA ===================
            doc.addPage();
            pageCount++;
            
            doc.setFontSize(22);
            doc.setTextColor(40, 167, 69);
            doc.text('DICAS DE ECONOMIA NA ALIMENTA√á√ÉO', 20, 25);
            
            doc.setDrawColor(40, 167, 69);
            doc.setLineWidth(2);
            doc.line(20, 30, 190, 30);
            
            yPos = 45;
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            
            // Dicas espec√≠ficas de economia
            const dicasEconomia = [
                {
                    titulo: 'üõí COMPRAS INTELIGENTES',
                    dicas: [
                        'Compre em atacados e feiras (final do dia)',
                        'Prefira marcas pr√≥prias dos supermercados',
                        'Compre carnes em promo√ß√£o e congele',
                        'Aproveite frutas e verduras da √©poca',
                        'Fa√ßa lista de compras e n√£o saia dela'
                    ]
                },
                {
                    titulo: 'üë©‚Äçüç≥ PREPARO ECON√îMICO',
                    dicas: [
                        'Cozinhe em grandes quantidades',
                        'Aproveite sobras para novas refei√ß√µes',
                        'Use todas as partes dos alimentos',
                        'Prepare temperos caseiros',
                        'Congele por√ß√µes individuais'
                    ]
                },
                {
                    titulo: 'üí° SUBSTITUI√á√ïES BARATAS',
                    dicas: [
                        'Troque carne vermelha por ovos 2x/semana',
                        'Use f√≠gado de frango (rico em ferro)',
                        'Substitua iogurte por vitamina caseira',
                        'Troque quinoa por lentilha',
                        'Use banana como ado√ßante natural'
                    ]
                }
            ];
            
            dicasEconomia.forEach(secao => {
                if (yPos > 250) {
                    doc.addPage();
                    pageCount++;
                    yPos = 30;
                }
                
                doc.setFontSize(12);
                doc.setTextColor(40, 167, 69);
                doc.text(secao.titulo, 20, yPos);
                yPos += 10;
                
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                
                secao.dicas.forEach(dica => {
                    doc.text('‚Ä¢ ' + dica, 25, yPos);
                    yPos += 7;
                });
                yPos += 10;
            });
            
            // Orienta√ß√µes espec√≠ficas por condi√ß√£o de sa√∫de (vers√£o econ√¥mica)
            if (hasDiabetes) {
                if (yPos > 220) {
                    doc.addPage();
                    pageCount++;
                    yPos = 30;
                }
                doc.setFontSize(12);
                doc.setTextColor(200, 0, 0);
                doc.text('‚ö†Ô∏è DIABETES - SOLU√á√ïES ECON√îMICAS:', 20, yPos);
                yPos += 10;
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                const diabetesEconomico = [
                    'Prefira arroz parboilizado (mais barato que integral)',
                    'Use canela em p√≥ para ado√ßar (barata e natural)',
                    'Coma frutas com casca (mais fibras, mesmo pre√ßo)',
                    'Batata doce √© mais barata que produtos diet',
                    'Aveia em flocos ajuda controlar glicemia'
                ];
                diabetesEconomico.forEach(orientacao => {
                    doc.text('‚Ä¢ ' + orientacao, 25, yPos);
                    yPos += 6;
                });
                yPos += 10;
            }
            
            if (hasHypertension) {
                if (yPos > 220) {
                    doc.addPage();
                    pageCount++;
                    yPos = 30;
                }
                doc.setFontSize(12);
                doc.setTextColor(200, 0, 0);
                doc.text('‚ö†Ô∏è HIPERTENS√ÉO - TEMPEROS BARATOS:', 20, yPos);
                yPos += 10;
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                const hipertensaoEconomico = [
                    'Use alho, cebola e cheiro verde (baratos)',
                    'Lim√£o √© mais barato que temperos prontos',
                    'Cultive ervas em casa (manjeric√£o, salsa)',
                    'Use menos sal e mais temperos naturais',
                    'Banana √© rica em pot√°ssio e barata'
                ];
                hipertensaoEconomico.forEach(orientacao => {
                    doc.text('‚Ä¢ ' + orientacao, 25, yPos);
                    yPos += 6;
                });
                yPos += 10;
            }
            
            // Orienta√ß√µes gerais econ√¥micas
            yPos += 5;
            doc.setFontSize(12);
            doc.setTextColor(40, 167, 69);
            doc.text('ORIENTA√á√ïES GERAIS ECON√îMICAS:', 20, yPos);
            yPos += 10;
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            
            let orientacoesEconomicas = [
                'Beba √°gua da torneira (filtrada) em vez de comprar',
                'Fa√ßa 4-5 refei√ß√µes com ingredientes b√°sicos',
                'Caf√© da manh√£ √© a refei√ß√£o mais barata e importante',
                'Pratique atividade f√≠sica gratuita (caminhada)',
                'Durma bem para controlar a fome',
                'Cozinhe mais, compre menos comida pronta',
                'Use panela de press√£o (economiza g√°s)',
                'Congele alimentos em promo√ß√£o'
            ];
            
            // Orienta√ß√µes espec√≠ficas por objetivo (econ√¥micas)
            if (userData.goal === 'lose_weight') {
                orientacoesEconomicas.push('Reduza por√ß√µes em vez de comprar produtos light');
                orientacoesEconomicas.push('Coma mais verduras baratas (acelga, couve)');
                orientacoesEconomicas.push('Caminhe 30 min/dia (exerc√≠cio gratuito)');
            } else if (userData.goal === 'gain_muscle') {
                orientacoesEconomicas.push('Coma mais ovos (prote√≠na mais barata)');
                orientacoesEconomicas.push('Inclua feij√£o em todas as refei√ß√µes');
                orientacoesEconomicas.push('Use exerc√≠cios com peso corporal');
            }
            
            orientacoesEconomicas.forEach(orientacao => {
                if (yPos > 270) {
                    doc.addPage();
                    pageCount++;
                    yPos = 30;
                }
                doc.text('‚Ä¢ ' + orientacao, 25, yPos);
                yPos += 6;
            });
            
            // =================== P√ÅGINA FINAL - CRONOGRAMA ECON√îMICO ===================
            doc.addPage();
            pageCount++;
            
            doc.setFontSize(22);
            doc.setTextColor(40, 167, 69);
            doc.text('CRONOGRAMA E OR√áAMENTO', 20, 25);
            
            doc.setDrawColor(40, 167, 69);
            doc.setLineWidth(2);
            doc.line(20, 30, 190, 30);
            
            yPos = 45;
            
            // Estimativa de gastos
            doc.setFontSize(14);
            doc.setTextColor(40, 167, 69);
            doc.text('üí∞ ESTIMATIVA DE GASTOS SEMANAIS', 20, yPos);
            yPos += 15;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            
            const gastosSemanais = [
                ['Prote√≠nas (ovos, frango, feij√£o):', 'R$ 25,00 - R$ 35,00'],
                ['Carboidratos (arroz, p√£o, batata):', 'R$ 15,00 - R$ 20,00'],
                ['Vegetais e frutas:', 'R$ 10,00 - R$ 15,00'],
                ['Temperos e b√°sicos:', 'R$ 8,00 - R$ 12,00'],
                ['TOTAL SEMANAL:', 'R$ 58,00 - R$ 82,00'],
                ['TOTAL MENSAL:', 'R$ 230,00 - R$ 330,00']
            ];
            
            gastosSemanais.forEach(([item, valor]) => {
                doc.text(item, 25, yPos);
                doc.text(valor, 120, yPos);
                yPos += 8;
            });
            
            yPos += 10;
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text('*Valores baseados em pre√ßos m√©dios do Brasil em 2024', 25, yPos);
            yPos += 15;
            
            doc.setFontSize(14);
            doc.setTextColor(40, 167, 69);
            doc.text('‚è∞ HOR√ÅRIOS IDEAIS DAS REFEI√á√ïES', 20, yPos);
            yPos += 15;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            
            const horariosEconomicos = [
                ['Caf√© da manh√£:', '7h00 - 8h00 (n√£o pule - evita gastos extras)'],
                ['Lanche da manh√£:', '10h00 - 10h30 (fruta simples)'], 
                ['Almo√ßo:', '12h00 - 13h00 (refei√ß√£o principal)'],
                ['Lanche da tarde:', '15h30 - 16h00 (p√£o ou fruta)'],
                ['Jantar:', '19h00 - 20h00 (mais leve)']
            ];
            
            horariosEconomicos.forEach(([refeicao, horario]) => {
                doc.text(refeicao, 25, yPos);
                doc.text(horario, 80, yPos);
                yPos += 8;
            });
            
            yPos += 15;
            doc.setFontSize(14);
            doc.setTextColor(40, 167, 69);
            doc.text('üìÖ CRONOGRAMA DE RESULTADOS', 20, yPos);
            yPos += 15;
            
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            
            const cronogramaEconomico = [
                'Semana 1-2: Organiza√ß√£o das compras e rotina',
                'Semana 3-4: Adapta√ß√£o aos sabores e economia real',
                'M√™s 2: Primeiros resultados vis√≠veis na sa√∫de',
                'M√™s 3: Economia consolidada no or√ßamento familiar',
                'M√™s 4+: H√°bitos saud√°veis e econ√¥micos estabelecidos'
            ];
            
            cronogramaEconomico.forEach(item => {
                doc.text('‚Ä¢ ' + item, 25, yPos);
                yPos += 8;
            });
            
            yPos += 20;
            doc.setFontSize(12);
            doc.setTextColor(40, 167, 69);
            doc.text('üí™ Sa√∫de de qualidade n√£o precisa ser cara!', 20, yPos);
            yPos += 10;
            doc.text('üèÜ Voc√™ consegue alcan√ßar seus objetivos economizando!', 20, yPos);
            
            console.log(`PDF econ√¥mico gerado com ${pageCount} p√°ginas para ${userData.name}`);
            return doc;
        }

        // Fun√ß√£o de download (atualizada para dieta econ√¥mica)
        function downloadFile(type) {
            if (type !== 'dieta-personalizada') {
                alert('Este material est√° dispon√≠vel na sua √°rea de membros exclusiva! Verifique seu e-mail para o link de acesso.');
                return;
            }

            try {
                const doc = generateDietaPDF();
                const userData = window.currentUserData || { name: 'Cliente' };
                const filename = `Dieta_Economica_${userData.name.replace(/\s+/g, '_')}_DrGiovana.pdf`;
                doc.save(filename);
                
                // Mostrar mensagem de sucesso personalizada
                const successMessage = document.createElement('div');
                successMessage.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(135deg, #28a745, #20c997);
                    color: white;
                    padding: 30px;
                    border-radius: 16px;
                    text-align: center;
                    z-index: 10000;
                    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
                    max-width: 400px;
                `;
                
                successMessage.innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 15px;">üí∞</div>
                    <h3 style="margin-bottom: 10px;">Dieta Econ√¥mica Baixada!</h3>
                    <p style="font-size: 14px; opacity: 0.9;">
                        Seu plano com alimentos baratos e nutritivos est√° pronto. 
                        Economize sem perder qualidade!
                    </p>
                `;
                
                document.body.appendChild(successMessage);
                
                setTimeout(() => {
                    successMessage.style.opacity = '0';
                    setTimeout(() => successMessage.remove(), 300);
                }, 3000);
                
            } catch (error) {
                console.error('Erro ao gerar PDF econ√¥mico:', error);
                alert('Erro ao gerar PDF. Tente novamente.');
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéØ P√°gina de obrigado ECON√îMICA carregada - iniciando sistema...');
            
            // ‚úÖ 1. CRIAR PART√çCULAS
            createParticles();
            
            // ‚úÖ 2. CARREGAR DADOS DO USU√ÅRIO (VERS√ÉO ECON√îMICA)
            loadUserData();
            
            // ‚úÖ 3. ADICIONAR BOT√ÉO DE DEBUG EM DESENVOLVIMENTO
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                setTimeout(() => {
                    addDebugButton();
                }, 1000);
            }
            
            console.log('üöÄ Sistema de obrigado ECON√îMICO inicializado com 100% de compatibilidade!');
        });

        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = window.innerWidth > 768 ? 50 : 25;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // ‚úÖ BOT√ÉO DE DEBUG PARA DESENVOLVIMENTO
        function addDebugButton() {
            if (document.getElementById('debugButton')) return;
            
            const debugButton = document.createElement('button');
            debugButton.id = 'debugButton';
            debugButton.textContent = 'üêõ Verificar Dados';
            debugButton.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                padding: 12px 20px;
                background: linear-gradient(135deg, #333, #555);
                color: white;
                border: 2px solid #666;
                border-radius: 10px;
                cursor: pointer;
                font-weight: bold;
                font-size: 12px;
                z-index: 9999;
                backdrop-filter: blur(10px);
                transition: all 0.3s ease;
            `;
            
            debugButton.onclick = () => {
                console.log('üîç Executando verifica√ß√£o manual...');
                showDebugInfo();
            };
            
            debugButton.onmouseover = () => {
                debugButton.style.transform = 'translateY(-2px)';
                debugButton.style.borderColor = '#28a745';
            };
            
            debugButton.onmouseout = () => {
                debugButton.style.transform = 'translateY(0)';
                debugButton.style.borderColor = '#666';
            };
            
            document.body.appendChild(debugButton);
        }

        // ‚úÖ FUN√á√ÉO DE DEBUG COMPLETA
        function showDebugInfo() {
            // Remover debug anterior se existir
            const existingDebug = document.getElementById('debugPanel');
            if (existingDebug) {
                existingDebug.remove();
                return;
            }

            const debugPanel = document.createElement('div');
            debugPanel.id = 'debugPanel';
            debugPanel.style.cssText = `
                position: fixed;
                top: 10px;
                left: 10px;
                width: 400px;
                max-height: 80vh;
                overflow-y: auto;
                background: rgba(0, 0, 0, 0.95);
                border: 2px solid #28a745;
                border-radius: 12px;
                padding: 20px;
                color: white;
                font-size: 12px;
                z-index: 9999;
                backdrop-filter: blur(10px);
                font-family: monospace;
            `;

            // Verificar dados atuais
            const quizData = getQuizData();
            const userData = window.currentUserData || {};
            const nutrition = window.currentNutrition || {};
            
            let debugContent = `
                <div style="text-align: center; margin-bottom: 15px;">
                    <div style="font-size: 18px; margin-bottom: 5px;">üîç DEBUG ECON√îMICO</div>
                    <div style="font-size: 12px; opacity: 0.8;">${new Date().toLocaleString()}</div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="color: #28a745; font-weight: bold; margin-bottom: 5px;">üìä STATUS GERAL:</div>
                    <div>‚Ä¢ Dados do quiz: ${quizData.hasData ? '‚úÖ Encontrados' : '‚ùå N√£o encontrados'}</div>
                    <div>‚Ä¢ Fonte: ${quizData.source || 'Nenhuma'}</div>
                    <div>‚Ä¢ Dados reais: ${window.hasRealData ? '‚úÖ Sim' : '‚ùå N√£o'}</div>
                    <div>‚Ä¢ Vers√£o: üí∞ Econ√¥mica</div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="color: #28a745; font-weight: bold; margin-bottom: 5px;">üë§ DADOS DO USU√ÅRIO:</div>
                    <div>‚Ä¢ Nome: ${userData.name || 'N/A'}</div>
                    <div>‚Ä¢ Peso: ${userData.weight || 'N/A'}kg</div>
                    <div>‚Ä¢ Altura: ${userData.height || 'N/A'}cm</div>
                    <div>‚Ä¢ Objetivo: ${userData.goal || 'N/A'}</div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="color: #28a745; font-weight: bold; margin-bottom: 5px;">üßÆ DADOS NUTRICIONAIS:</div>
                    <div>‚Ä¢ Calorias: ${nutrition.calories || 'N/A'}</div>
                    <div>‚Ä¢ Prote√≠nas: ${nutrition.protein || 'N/A'}g</div>
                    <div>‚Ä¢ Carboidratos: ${nutrition.carbs || 'N/A'}g</div>
                    <div>‚Ä¢ Gorduras: ${nutrition.fats || 'N/A'}g</div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="color: #28a745; font-weight: bold; margin-bottom: 5px;">üíæ LOCALSTORAGE:</div>
            `;

            // Verificar localStorage
            const localStorageData = [];
            try {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('dra_giovana_')) {
                        localStorageData.push(key);
                    }
                }
            } catch (e) {
                debugContent += `<div style="color: #ff3366;">Erro: ${e.message}</div>`;
            }

            if (localStorageData.length > 0) {
                localStorageData.forEach(key => {
                    debugContent += `<div>‚Ä¢ ${key.replace('dra_giovana_', '')}</div>`;
                });
            } else {
                debugContent += `<div style="color: #ff3366;">‚Ä¢ Nenhum dado encontrado</div>`;
            }

            debugContent += `
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="color: #28a745; font-weight: bold; margin-bottom: 5px;">üîß A√á√ïES:</div>
                    <button onclick="console.log('Quiz Data:', getQuizData())" style="
                        background: #333; color: white; border: 1px solid #666; 
                        padding: 5px 10px; margin: 2px; border-radius: 4px; 
                        cursor: pointer; font-size: 10px;
                    ">Log Quiz Data</button>
                    <button onclick="console.log('User Data:', window.currentUserData)" style="
                        background: #333; color: white; border: 1px solid #666; 
                        padding: 5px 10px; margin: 2px; border-radius: 4px; 
                        cursor: pointer; font-size: 10px;
                    ">Log User Data</button>
                    <button onclick="console.log('Nutrition:', window.currentNutrition)" style="
                        background: #333; color: white; border: 1px solid #666; 
                        padding: 5px 10px; margin: 2px; border-radius: 4px; 
                        cursor: pointer; font-size: 10px;
                    ">Log Nutrition</button>
                </div>

                <div style="text-align: center;">
                    <button onclick="document.getElementById('debugPanel').remove()" style="
                        background: #ff3366; color: white; border: none; 
                        padding: 8px 15px; border-radius: 6px; cursor: pointer; 
                        font-weight: bold; font-size: 11px;
                    ">Fechar Debug</button>
                </div>
            `;

            debugPanel.innerHTML = debugContent;
            document.body.appendChild(debugPanel);
        }

        // Salvar progresso
        function saveUserProgress() {
            try {
                // Tentar salvar em ambos os locais para compatibilidade m√°xima
                if (typeof(Storage) !== "undefined") {
                    // sessionStorage (m√©todo antigo)
                    sessionStorage.setItem('userCompleted', 'true');
                    sessionStorage.setItem('completionDate', new Date().toISOString());
                    
                    // localStorage (m√©todo atual)
                    const progressData = {
                        completed: true,
                        completionDate: new Date().toISOString(),
                        pageVisited: 'thank_you_economica',
                        dietType: 'economica',
                        timestamp: Date.now()
                    };
                    
                    localStorage.setItem('dra_giovana_progress', JSON.stringify(progressData));
                    console.log('üíæ Progresso econ√¥mico salvo nos dois sistemas');
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Erro ao salvar progresso:', error);
            }
        }

        // ‚úÖ FUN√á√ÉO PARA TESTAR O SISTEMA COMPLETO
        function testCompleteSystem() {
            console.log('üß™ Testando sistema econ√¥mico completo...');
            
            try {
                // 1. Testar leitura de dados
                const quizData = getQuizData();
                console.log('1. Dados do quiz:', quizData.hasData ? '‚úÖ' : '‚ùå');
                
                // 2. Testar processamento
                const userData = processUserData(quizData);
                console.log('2. Processamento:', userData ? '‚úÖ' : '‚ùå');
                
                // 3. Testar c√°lculos
                const nutrition = calculateNutritionFromQuiz(userData);
                console.log('3. C√°lculos nutricionais:', nutrition ? '‚úÖ' : '‚ùå');
                
                // 4. Testar gera√ß√£o de PDF econ√¥mico
                const pdf = generateDietaPDF();
                console.log('4. Gera√ß√£o de PDF econ√¥mico:', pdf ? '‚úÖ' : '‚ùå');
                
                console.log('‚úÖ Sistema econ√¥mico funcionando perfeitamente!');
                return true;
                
            } catch (error) {
                console.error('‚ùå Erro no teste completo:', error);
                return false;
            }
        }

        // Executar ao carregar
        saveUserProgress();

        // ‚úÖ TORNAR FUN√á√ïES DISPON√çVEIS GLOBALMENTE PARA DEBUG
        window.testCompleteSystem = testCompleteSystem;
        window.showDebugInfo = showDebugInfo;
        window.getQuizData = getQuizData;
        
        console.log('‚úÖ Sistema econ√¥mico carregado - 100% compat√≠vel com p√°gina index');
        console.log('üîß Para debug: testCompleteSystem(), showDebugInfo()');
        console.log('üí∞ Vers√£o: Dieta Econ√¥mica com alimentos acess√≠veis');
    </script>
</body>
</html> 