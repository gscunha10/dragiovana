<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sua Dieta Personalizada - Dra. Giovana Nutricionista</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2c7a2c;
            --secondary: #4a9f4a;
            --accent: #6cc04a;
            --dark: #0a0a0a;
            --light: #ffffff;
            --gray: #1a1a1a;
            --success: #00ff88;
            --danger: #ff3366;
            --gold: #FFD700;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, rgba(44, 122, 44, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(108, 192, 74, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(74, 159, 74, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            min-height: 100vh;
            color: var(--light);
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--accent);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
            opacity: 0.3;
        }

        .particle:nth-child(odd) {
            background: var(--primary);
            animation-duration: 8s;
        }

        .particle:nth-child(3n) {
            background: var(--secondary);
            animation-duration: 10s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
            50% { transform: translateY(-100px) rotate(180deg); opacity: 0.8; }
        }

        .header {
            position: relative;
            z-index: 100;
            padding: 20px 0;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(44, 122, 44, 0.2);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 20px rgba(44, 122, 44, 0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 10;
        }

        .success-header {
            text-align: center;
            margin-bottom: 50px;
            animation: slideInUp 1s ease-out;
        }

        .success-icon {
            font-size: 100px;
            margin-bottom: 20px;
            animation: successBounce 1.5s ease-out;
        }

        .success-title {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--success), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .success-subtitle {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
            line-height: 1.5;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .welcome-card {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(30px);
            border-radius: 32px;
            padding: 40px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(44, 122, 44, 0.2);
            box-shadow: 
                0 32px 64px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .welcome-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary), var(--accent), var(--secondary));
            border-radius: 32px;
            padding: 2px;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: xor;
            -webkit-mask-composite: xor;
            opacity: 0.6;
            animation: borderGlow 3s ease-in-out infinite alternate;
        }

        @keyframes borderGlow {
            0% { opacity: 0.3; }
            100% { opacity: 0.8; }
        }

        .user-name {
            font-size: 32px;
            font-weight: 800;
            color: var(--accent);
            margin-bottom: 15px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
            margin-bottom: 50px;
            align-items: start;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
            min-width: 0;
        }

        .diet-card {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(30px);
            border-radius: 24px;
            padding: 35px;
            border: 1px solid rgba(44, 122, 44, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .diet-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .diet-card:hover::before {
            left: 100%;
        }

        .card-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--light), rgba(255, 255, 255, 0.8));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .profile-summary {
            background: linear-gradient(135deg, rgba(44, 122, 44, 0.1), rgba(108, 192, 74, 0.1));
            border: 2px solid rgba(44, 122, 44, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .profile-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            min-width: 0;
        }

        .profile-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .profile-item > div {
            min-width: 0;
            word-wrap: break-word;
        }

        .macros-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .macro-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            min-width: 0;
        }

        .macro-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(44, 122, 44, 0.2);
        }

        .macro-card.calories {
            border-color: var(--danger);
            background: rgba(255, 51, 102, 0.1);
        }

        .macro-card.protein {
            border-color: var(--primary);
            background: rgba(44, 122, 44, 0.1);
        }

        .macro-card.carbs {
            border-color: var(--gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .macro-card.fats {
            border-color: var(--accent);
            background: rgba(108, 192, 74, 0.1);
        }

        .macro-icon {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .macro-value {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 5px;
            word-break: break-word;
        }

        .macro-value.calories { color: var(--danger); }
        .macro-value.protein { color: var(--primary); }
        .macro-value.carbs { color: var(--gold); }
        .macro-value.fats { color: var(--accent); }

        .macro-label {
            font-size: 12px;
            font-weight: 700;
            color: var(--light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            word-break: break-word;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
            min-width: 0;
        }

        .download-section {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(30px);
            border-radius: 24px;
            padding: 30px;
            border: 1px solid rgba(44, 122, 44, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 20px;
            width: 100%;
            max-width: 100%;
        }

        .download-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 20px;
            text-align: center;
            color: var(--accent);
        }

        .download-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            width: 100%;
            min-width: 0;
        }

        .download-item:hover {
            background: rgba(44, 122, 44, 0.1);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .download-item.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: rgba(255, 255, 255, 0.03);
        }

        .download-item.disabled:hover {
            background: rgba(255, 255, 255, 0.03);
            border-color: rgba(255, 255, 255, 0.1);
            transform: none;
        }

        .download-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .download-item.disabled .download-icon {
            background: rgba(255, 255, 255, 0.2);
        }

        .download-info {
            flex: 1;
            min-width: 0;
        }

        .download-name {
            font-size: 14px;
            font-weight: 700;
            color: var(--light);
            margin-bottom: 3px;
            word-wrap: break-word;
        }

        .download-desc {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            word-wrap: break-word;
        }

        .download-button {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
            margin-top: 20px;
        }

        .download-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(44, 122, 44, 0.4);
        }

        .members-area-info {
            background: rgba(0, 123, 255, 0.1);
            border: 1px solid rgba(0, 123, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .members-area-info h4 {
            color: #00bfff;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .members-area-info p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes successBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr 350px;
                gap: 30px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            .success-title {
                font-size: 32px;
            }

            .success-subtitle {
                font-size: 16px;
            }

            .content-grid {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .main-content {
                order: -1;
            }

            .sidebar {
                order: 1;
            }

            .profile-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
            }

            .macros-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .download-section {
                position: static;
            }

            .diet-card, .welcome-card, .download-section {
                padding: 25px 20px;
            }

            .logo {
                font-size: 20px;
            }

            .logo-icon {
                width: 35px;
                height: 35px;
                font-size: 18px;
            }
        }

        @media (max-width: 480px) {
            .success-icon {
                font-size: 70px;
            }

            .success-title {
                font-size: 28px;
            }

            .macros-grid {
                grid-template-columns: 1fr;
            }

            .diet-card, .welcome-card, .download-section {
                padding: 20px 15px;
                border-radius: 16px;
            }

            .profile-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="particles" id="particles"></div>

    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">👩‍⚕️</div>
                <span>Dra. Giovana Nutricionista</span>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="success-header">
            <div class="success-icon">🎉</div>
            <h1 class="success-title">Parabéns! Sua Dieta Está Pronta!</h1>
            <p class="success-subtitle">
                Seu plano nutricional personalizado foi criado com base na sua avaliação completa. 
                Agora você tem tudo que precisa para alcançar seus objetivos de forma saudável e sustentável.
            </p>
        </div>

        <div class="welcome-card">
            <h2 class="user-name" id="userName">Olá, Maria Silva!</h2>
            <p style="font-size: 16px; color: rgba(255, 255, 255, 0.8); line-height: 1.5;">
                Seu protocolo nutricional personalizado está pronto! Baseado em evidências científicas e 
                adaptado especialmente para seu perfil, objetivos e restrições alimentares.
            </p>
        </div>

        <div class="content-grid">
            <div class="main-content">
                <div class="diet-card">
                    <h3 class="card-title">📊 Seu Perfil Nutricional</h3>
                    
                    <div class="profile-summary">
                        <div class="profile-grid" id="profileGrid">
                            <div class="profile-item">
                                <div class="profile-icon">🎯</div>
                                <div>
                                    <strong>Objetivo:</strong><br>
                                    <span id="userGoal">Perder Peso</span>
                                </div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-icon">⚖️</div>
                                <div>
                                    <strong>Peso Atual:</strong><br>
                                    <span id="userWeight">70kg</span>
                                </div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-icon">📏</div>
                                <div>
                                    <strong>Altura:</strong><br>
                                    <span id="userHeight">170cm</span>
                                </div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-icon">🎂</div>
                                <div>
                                    <strong>Idade:</strong><br>
                                    <span id="userAge">26-35 anos</span>
                                </div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-icon">🏃</div>
                                <div>
                                    <strong>Atividade:</strong><br>
                                    <span id="userActivity">Moderada</span>
                                </div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-icon">🥗</div>
                                <div>
                                    <strong>Dieta:</strong><br>
                                    <span id="userDiet">Sem restrições</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4 style="font-size: 18px; font-weight: 700; margin-bottom: 15px; color: var(--accent);">🔢 Suas Metas Diárias</h4>
                    <div class="macros-grid">
                        <div class="macro-card calories">
                            <div class="macro-icon">🔥</div>
                            <div class="macro-value calories" id="targetCalories">1500</div>
                            <div class="macro-label">Calorias</div>
                        </div>
                        <div class="macro-card protein">
                            <div class="macro-icon">🥩</div>
                            <div class="macro-value protein" id="targetProtein">120g</div>
                            <div class="macro-label">Proteínas</div>
                        </div>
                        <div class="macro-card carbs">
                            <div class="macro-icon">🌾</div>
                            <div class="macro-value carbs" id="targetCarbs">150g</div>
                            <div class="macro-label">Carboidratos</div>
                        </div>
                        <div class="macro-card fats">
                            <div class="macro-icon">🥑</div>
                            <div class="macro-value fats" id="targetFats">50g</div>
                            <div class="macro-label">Gorduras</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="download-section">
                    <h3 class="download-title">📁 Seus Materiais</h3>
                    
                    <div class="download-item" onclick="downloadFile('dieta-personalizada')">
                        <div class="download-icon">📋</div>
                        <div class="download-info">
                            <div class="download-name">Dieta Personalizada</div>
                            <div class="download-desc">Seu plano completo em PDF</div>
                        </div>
                    </div>

                    <div class="download-item disabled">
                        <div class="download-icon">📅</div>
                        <div class="download-info">
                            <div class="download-name">Cardápio 30 Dias</div>
                            <div class="download-desc">Disponível na área de membros</div>
                        </div>
                    </div>

                    <div class="download-item disabled">
                        <div class="download-icon">👩‍🍳</div>
                        <div class="download-info">
                            <div class="download-name">200+ Receitas</div>
                            <div class="download-desc">Disponível na área de membros</div>
                        </div>
                    </div>

                    <div class="download-item disabled">
                        <div class="download-icon">📝</div>
                        <div class="download-info">
                            <div class="download-name">Lista de Alimentos</div>
                            <div class="download-desc">Disponível na área de membros</div>
                        </div>
                    </div>

                    <button class="download-button" onclick="downloadFile('dieta-personalizada')">
                        📥 BAIXAR DIETA PERSONALIZADA
                    </button>

                    <div class="members-area-info">
                        <h4>🔑 Área de Membros</h4>
                        <p>Os demais materiais (cardápio, receitas e lista de alimentos) estão disponíveis na sua área de membros exclusiva. O link de acesso foi enviado para o seu e-mail!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
       // Função para ler dados do sessionStorage
function getQuizData() {
    try {
        const quizAnswers = JSON.parse(sessionStorage.getItem('quizAnswers') || '{}');
        const quizResults = JSON.parse(sessionStorage.getItem('quizResults') || '{}');
        const contactData = JSON.parse(sessionStorage.getItem('userContactData') || '{}');
        
        console.log('Dados recuperados do sessionStorage:', {
            answers: quizAnswers,
            results: quizResults,
            contact: contactData
        });
        
        return {
            answers: quizAnswers,
            results: quizResults,
            contact: contactData,
            hasData: Object.keys(quizAnswers).length > 0
        };
    } catch (error) {
        console.error('Erro ao ler dados do sessionStorage:', error);
        return {
            answers: {},
            results: {},
            contact: {},
            hasData: false
        };
    }
}

// Dados padrão caso não tenha dados do quiz
const defaultUserData = {
    name: "Cliente",
    goal: "lose_weight",
    gender: "female",
    age: "26-35",
    activity: "moderate",
    weight: 75,
    height: 165,
    targetWeight: 65,
    diet: "no_restrictions",
    health: ["healthy"],
    allergies: ["no_allergies"]
};

// Traduções completas
const translations = {
    goal: {
        lose_weight: "Perder Peso",
        gain_muscle: "Ganhar Massa Muscular", 
        maintain: "Manter Peso",
        health: "Melhorar Saúde"
    },
    gender: {
        male: "Masculino",
        female: "Feminino"
    },
    activity: {
        sedentary: "Sedentário",
        light: "Leve",
        moderate: "Moderada",
        intense: "Intensa"
    },
    diet: {
        no_restrictions: "Sem restrições",
        vegetarian: "Vegetariana",
        vegan: "Vegana",
        low_carb: "Low Carb",
        mediterranean: "Mediterrânea",
        paleo: "Paleo"
    },
    age: {
        "18-25": "18-25 anos",
        "26-35": "26-35 anos", 
        "36-45": "36-45 anos",
        "46-55": "46-55 anos",
        "55+": "55+ anos"
    },
    health: {
        healthy: "Saudável",
        diabetes: "Diabetes",
        hypertension: "Hipertensão",
        thyroid: "Problemas na Tireoide",
        digestive: "Problemas Digestivos",
        kidney: "Problemas Renais",
        heart: "Problemas Cardíacos"
    },
    allergies: {
        no_allergies: "Sem Alergias",
        lactose: "Intolerância à Lactose",
        gluten: "Intolerância ao Glúten",
        nuts: "Alergia a Oleaginosas",
        seafood: "Alergia a Frutos do Mar",
        eggs: "Alergia a Ovos",
        soy: "Alergia à Soja"
    }
};

// Função para processar dados do usuário
function processUserData(quizData) {
    if (!quizData.hasData) {
        console.log('Usando dados padrão - não há dados do quiz');
        return defaultUserData;
    }
    
    const { answers, contact } = quizData;
    const physical = answers.physical || {};
    
    return {
        name: contact.name || "Cliente",
        email: contact.email || "",
        phone: contact.phone || "",
        goal: answers.goal || "lose_weight",
        gender: answers.gender || "female",
        age: answers.age || "26-35",
        activity: answers.activity || "moderate",
        weight: parseFloat(physical.weight) || 75,
        height: parseFloat(physical.height) || 165,
        targetWeight: parseFloat(physical.target_weight) || 65,
        diet: answers.diet || "no_restrictions",
        health: answers.health || ["healthy"],
        allergies: answers.allergies || ["no_allergies"]
    };
}

// Função para calcular nutrição baseada nos dados reais
function calculateNutritionFromQuiz(userData) {
    const weight = userData.weight;
    const height = userData.height;
    const goal = userData.goal;
    const activity = userData.activity;
    const gender = userData.gender;
    
    // Calcular idade média baseada na faixa
    const ageRanges = {
        '18-25': 21.5,
        '26-35': 30.5,
        '36-45': 40.5,
        '46-55': 50.5,
        '55+': 60
    };
    const ageValue = ageRanges[userData.age] || 30;
    
    // Calcular TMB (Taxa Metabólica Basal)
    let bmr;
    if (gender === 'male') {
        bmr = 10 * weight + 6.25 * height - 5 * ageValue + 5;
    } else {
        bmr = 10 * weight + 6.25 * height - 5 * ageValue - 161;
    }
    
    // Multiplicadores de atividade
    const activityMultipliers = {
        sedentary: 1.2,
        light: 1.375,
        moderate: 1.55,
        intense: 1.725
    };
    
    const tdee = bmr * (activityMultipliers[activity] || 1.55);
    
    // Ajustar calorias baseado no objetivo
    let calories;
    switch(goal) {
        case 'lose_weight':
            calories = Math.round(tdee - 500);
            break;
        case 'gain_muscle':
            calories = Math.round(tdee + 300);
            break;
        default:
            calories = Math.round(tdee);
    }
    
    // Calcular macronutrientes
    const protein = Math.round(weight * 2.2);
    const fats = Math.round(calories * 0.25 / 9);
    const carbs = Math.round((calories - (protein * 4) - (fats * 9)) / 4);
    
    return { 
        calories, 
        protein, 
        carbs, 
        fats,
        bmr: Math.round(bmr),
        tdee: Math.round(tdee)
    };
}

// Função para gerar mensagem personalizada baseada no objetivo
function getPersonalizedMessage(userData) {
    const { goal, weight, targetWeight, health, allergies } = userData;
    
    let message = "";
    
    switch(goal) {
        case 'lose_weight':
            const weightToLose = weight - targetWeight;
            message = `Seu protocolo foi desenvolvido para eliminar ${weightToLose}kg de forma saudável e sustentável. `;
            break;
        case 'gain_muscle':
            message = "Seu protocolo foi desenvolvido para ganho de massa muscular magra e definição corporal. ";
            break;
        case 'maintain':
            message = "Seu protocolo foi desenvolvido para manutenção do peso e equilíbrio nutricional. ";
            break;
        case 'health':
            message = "Seu protocolo foi desenvolvido para otimização da saúde e bem-estar geral. ";
            break;
    }
    
    // Adicionar informações sobre condições de saúde
    if (health && health.length > 0 && !health.includes('healthy')) {
        message += "Consideramos suas condições de saúde específicas na elaboração do plano. ";
    }
    
    // Adicionar informações sobre alergias
    if (allergies && allergies.length > 0 && !allergies.includes('no_allergies')) {
        message += "Todas as suas restrições alimentares foram respeitadas no cardápio. ";
    }
    
    return message;
}

// Dados para PDFs
const pdfData = {
    receitas: [
        {
            categoria: "Café da Manhã",
            nome: "Omelete de Claras com Espinafre",
            ingredientes: [
                "3 claras de ovo", "1 ovo inteiro", "1 xícara de espinafre fresco",
                "5 tomates cereja cortados ao meio", "1 colher de chá de azeite extra virgem",
                "Sal marinho e pimenta-do-reino a gosto", "Ervas finas (manjericão, salsa)"
            ],
            preparo: [
                "Separe as claras das gemas com cuidado", "Bata as claras com o ovo inteiro até ficar homogêneo",
                "Tempere com sal, pimenta e ervas finas", "Aqueça o azeite em frigideira antiaderente",
                "Adicione o espinafre e refogue por 1 minuto", "Despeje a mistura de ovos na frigideira",
                "Distribua os tomates cereja por cima", "Cozinhe em fogo médio por 3-4 minutos",
                "Dobre a omelete ao meio e sirva quente"
            ],
            calorias: 280, proteinas: "22g", carboidratos: "8g", gorduras: "18g", tempo: "15 minutos"
        }
        // ... outras receitas podem ser adicionadas aqui
    ]
};

// Inicialização
document.addEventListener('DOMContentLoaded', function() {
    createParticles();
    loadUserData();
});

function createParticles() {
    const particlesContainer = document.getElementById('particles');
    const particleCount = window.innerWidth > 768 ? 50 : 25;

    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 6 + 's';
        particlesContainer.appendChild(particle);
    }
}

// Função principal para carregar dados do usuário
function loadUserData() {
    const quizData = getQuizData();
    const userData = processUserData(quizData);
    const nutrition = calculateNutritionFromQuiz(userData);
    
    // Atualizar interface com dados personalizados
    updateUserInterface(userData, nutrition);
    
    // Salvar dados globalmente para uso no PDF
    window.currentUserData = userData;
    window.currentNutrition = nutrition;
    
    console.log('Dados carregados:', { userData, nutrition, quizData });
}

// Função para atualizar a interface
function updateUserInterface(userData, nutrition) {
    // Nome do usuário
    const firstName = userData.name.split(' ')[0];
    document.getElementById('userName').textContent = `Olá, ${firstName}!`;
    
    // Perfil do usuário
    document.getElementById('userGoal').textContent = translations.goal[userData.goal] || 'Objetivo não definido';
    document.getElementById('userWeight').textContent = userData.weight + 'kg';
    document.getElementById('userHeight').textContent = userData.height + 'cm';
    document.getElementById('userAge').textContent = translations.age[userData.age] || userData.age;
    document.getElementById('userActivity').textContent = translations.activity[userData.activity] || 'Não definido';
    document.getElementById('userDiet').textContent = translations.diet[userData.diet] || 'Não definido';
    
    // Metas nutricionais
    document.getElementById('targetCalories').textContent = nutrition.calories;
    document.getElementById('targetProtein').textContent = nutrition.protein + 'g';
    document.getElementById('targetCarbs').textContent = nutrition.carbs + 'g';
    document.getElementById('targetFats').textContent = nutrition.fats + 'g';
    
    // Atualizar subtítulo com mensagem personalizada
    const welcomeCard = document.querySelector('.welcome-card p');
    if (welcomeCard) {
        const personalizedMessage = getPersonalizedMessage(userData);
        welcomeCard.innerHTML = personalizedMessage + 'Baseado em evidências científicas e adaptado especialmente para seu perfil, objetivos e restrições alimentares.';
    }
    
    // Adicionar informações de saúde se houver
    addHealthInformation(userData);
}

// Função para adicionar informações de saúde
function addHealthInformation(userData) {
    const profileGrid = document.getElementById('profileGrid');
    
    // Adicionar condições de saúde se houver
    if (userData.health && userData.health.length > 0 && !userData.health.includes('healthy')) {
        const healthItem = document.createElement('div');
        healthItem.className = 'profile-item';
        healthItem.innerHTML = `
            <div class="profile-icon">🏥</div>
            <div>
                <strong>Condições:</strong><br>
                <span>${userData.health.map(h => translations.health[h] || h).join(', ')}</span>
            </div>
        `;
        profileGrid.appendChild(healthItem);
    }
    
    // Adicionar alergias se houver
    if (userData.allergies && userData.allergies.length > 0 && !userData.allergies.includes('no_allergies')) {
        const allergyItem = document.createElement('div');
        allergyItem.className = 'profile-item';
        allergyItem.innerHTML = `
            <div class="profile-icon">⚠️</div>
            <div>
                <strong>Restrições:</strong><br>
                <span>${userData.allergies.map(a => translations.allergies[a] || a).join(', ')}</span>
            </div>
        `;
        profileGrid.appendChild(allergyItem);
    }
}

// Função de geração de PDF atualizada
function generateDietaPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    const userData = window.currentUserData || defaultUserData;
    const nutrition = window.currentNutrition || { calories: 1500, protein: 120, carbs: 150, fats: 50 };
    
    // Detectar alergias/intolerâncias para adaptar receitas
    const hasLactoseIntolerance = userData.allergies && userData.allergies.includes('lactose');
    const hasGlutenIntolerance = userData.allergies && userData.allergies.includes('gluten');
    const hasNutsAllergy = userData.allergies && userData.allergies.includes('nuts');
    const hasSeafoodAllergy = userData.allergies && userData.allergies.includes('seafood');
    
    // Detectar condições de saúde para orientações específicas
    const hasDiabetes = userData.health && userData.health.includes('diabetes');
    const hasHypertension = userData.health && userData.health.includes('hypertension');
    const hasHeartProblems = userData.health && userData.health.includes('heart');
    
    let pageCount = 1;
    
    // =================== CAPA ===================
    doc.setFillColor(44, 122, 44);
    doc.rect(0, 0, 210, 297, 'F');
    
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(32);
    doc.text('DIETA PERSONALIZADA', 105, 70, { align: 'center' });
    
    doc.setFontSize(18);
    doc.text('Protocolo Nutricional Completo', 105, 90, { align: 'center' });
    
    doc.setFontSize(26);
    doc.text(userData.name, 105, 130, { align: 'center' });
    
    doc.setFontSize(16);
    doc.text(`Objetivo: ${translations.goal[userData.goal] || userData.goal}`, 105, 150, { align: 'center' });
    doc.text(`${nutrition.calories} calorias diárias`, 105, 170, { align: 'center' });
    
    doc.setFontSize(14);
    doc.text('Dra. Giovana Nutricionista', 105, 210, { align: 'center' });
    doc.text('CRN: 3 87654 | Especialista em Nutrição Clínica', 105, 225, { align: 'center' });
    
    const today = new Date().toLocaleDateString('pt-BR');
    doc.text('Data: ' + today, 105, 260, { align: 'center' });
    
    // =================== PÁGINA 2 - AVALIAÇÃO ===================
    doc.addPage();
    pageCount++;
    
    doc.setTextColor(0, 0, 0);
    doc.setFontSize(22);
    doc.setTextColor(44, 122, 44);
    doc.text('SUA AVALIAÇÃO NUTRICIONAL', 20, 25);
    
    doc.setDrawColor(44, 122, 44);
    doc.setLineWidth(2);
    doc.line(20, 30, 190, 30);
    
    let yPos = 45;
    doc.setFontSize(14);
    doc.setTextColor(0, 0, 0);
    doc.text('DADOS PESSOAIS', 20, yPos);
    yPos += 15;
    
    doc.setFontSize(11);
    const dadosUsuario = [
        ['Nome:', userData.name],
        ['Objetivo:', translations.goal[userData.goal] || userData.goal],
        ['Peso Atual:', userData.weight + 'kg'],
        ['Altura:', userData.height + 'cm'],
        ['Faixa Etária:', translations.age[userData.age] || userData.age],
        ['Nível de Atividade:', translations.activity[userData.activity] || userData.activity],
        ['Tipo de Dieta:', translations.diet[userData.diet] || userData.diet]
    ];
    
    dadosUsuario.forEach(([label, value]) => {
        doc.text(label, 25, yPos);
        doc.text(value, 80, yPos);
        yPos += 8;
    });
    
    // Condições de saúde
    if (userData.health && userData.health.length > 0 && !userData.health.includes('healthy')) {
        yPos += 10;
        doc.setFontSize(12);
        doc.setTextColor(44, 122, 44);
        doc.text('CONDIÇÕES DE SAÚDE:', 25, yPos);
        yPos += 8;
        doc.setFontSize(11);
        doc.setTextColor(0, 0, 0);
        userData.health.forEach(condition => {
            doc.text('• ' + (translations.health[condition] || condition), 30, yPos);
            yPos += 7;
        });
    }
    
    // Alergias/Intolerâncias
    if (userData.allergies && userData.allergies.length > 0 && !userData.allergies.includes('no_allergies')) {
        yPos += 10;
        doc.setFontSize(12);
        doc.setTextColor(44, 122, 44);
        doc.text('RESTRIÇÕES ALIMENTARES:', 25, yPos);
        yPos += 8;
        doc.setFontSize(11);
        doc.setTextColor(0, 0, 0);
        userData.allergies.forEach(allergy => {
            doc.text('• ' + (translations.allergies[allergy] || allergy), 30, yPos);
            yPos += 7;
        });
    }
    
    // Cálculos
    yPos += 15;
    doc.setFontSize(14);
    doc.setTextColor(44, 122, 44);
    doc.text('SEUS NÚMEROS', 20, yPos);
    yPos += 12;
    
    doc.setFontSize(11);
    doc.setTextColor(0, 0, 0);
    
    const imc = (userData.weight / ((userData.height/100) * (userData.height/100))).toFixed(1);
    let imcClass = '';
    if (imc < 18.5) imcClass = 'Abaixo do peso';
    else if (imc < 25) imcClass = 'Peso normal';
    else if (imc < 30) imcClass = 'Sobrepeso';
    else imcClass = 'Obesidade';
    
    const calculos = [
        ['IMC:', `${imc} kg/m² (${imcClass})`],
        ['TMB (metabolismo basal):', `${nutrition.bmr || 'N/A'} calorias/dia`],
        ['Calorias meta diárias:', `${nutrition.calories} calorias`],
        ['Proteínas diárias:', `${nutrition.protein}g`],
        ['Carboidratos diários:', `${nutrition.carbs}g`],
        ['Gorduras diárias:', `${nutrition.fats}g`]
    ];
    
    calculos.forEach(([label, value]) => {
        doc.text(label, 25, yPos);
        doc.text(value, 100, yPos);
        yPos += 8;
    });
    
    // =================== PÁGINA 3 - CARDÁPIO 7 DIAS ===================
    doc.addPage();
    pageCount++;
    
    doc.setFontSize(22);
    doc.setTextColor(44, 122, 44);
    doc.text('CARDÁPIO PERSONALIZADO - 7 DIAS', 20, 25);
    
    doc.setDrawColor(44, 122, 44);
    doc.setLineWidth(2);
    doc.line(20, 30, 190, 30);
    
    yPos = 45;
    doc.setFontSize(10);
    doc.setTextColor(0, 0, 0);
    
    // Cardápio adaptado às restrições
    const cardapio = [
        {
            dia: 'SEGUNDA-FEIRA',
            cafe: hasLactoseIntolerance ? 'Omelete de claras + Pão integral + Leite vegetal' : 'Omelete + Pão integral + Iogurte grego',
            lanche1: hasNutsAllergy ? 'Maçã + Pasta de amendoim' : 'Maçã + Mix de castanhas',
            almoco: 'Frango grelhado + Arroz integral + Salada verde + Azeite',
            lanche2: hasLactoseIntolerance ? 'Vitamina de banana com leite de aveia' : 'Vitamina de banana com leite',
            jantar: hasSeafoodAllergy ? 'Carne magra + Legumes refogados + Batata doce' : 'Salmão grelhado + Legumes no vapor + Batata doce'
        },
        {
            dia: 'TERÇA-FEIRA', 
            cafe: hasGlutenIntolerance ? 'Tapioca com ovo + Suco verde' : 'Panqueca de aveia + Frutas vermelhas',
            lanche1: 'Pera + Amendoim torrado',
            almoco: 'Peixe grelhado + Quinoa + Brócolis refogado + Azeite',
            lanche2: hasLactoseIntolerance ? 'Smoothie de manga com leite de coco' : 'Iogurte com granola',
            jantar: 'Frango desfiado + Abobrinha refogada + Inhame'
        },
        {
            dia: 'QUARTA-FEIRA',
            cafe: hasLactoseIntolerance ? 'Mingau de aveia com leite vegetal + Banana' : 'Mingau de aveia + Leite + Banana',
            lanche1: 'Laranja + Pasta de amendoim integral',
            almoco: 'Carne magra + Arroz integral + Feijão + Salada mista',
            lanche2: 'Abacate batido com cacau',
            jantar: hasSeafoodAllergy ? 'Ovo mexido + Legumes + Mandioca' : 'Tilápia + Aspargos + Batata inglesa'
        },
        {
            dia: 'QUINTA-FEIRA',
            cafe: hasGlutenIntolerance ? 'Ovo mexido + Tapioca + Abacate' : 'Torrada integral + Pasta de amendoim + Banana',
            lanche1: 'Mamão + Semente de chia',
            almoco: 'Frango + Macarrão integral + Molho de tomate caseiro + Salada',
            lanche2: hasLactoseIntolerance ? 'Vitamina verde com leite vegetal' : 'Queijo cottage + Frutas',
            jantar: 'Carne moída magra + Abobrinha + Arroz integral'
        },
        {
            dia: 'SEXTA-FEIRA',
            cafe: hasLactoseIntolerance ? 'Smoothie bowl com frutas e granola' : 'Iogurte grego + Granola + Mel',
            lanche1: 'Maçã + Canela',
            almoco: hasSeafoodAllergy ? 'Frango + Lentilha + Salada colorida' : 'Salmão + Lentilha + Salada colorida',
            lanche2: 'Castanha do Brasil + Água de coco',
            jantar: 'Omelete de legumes + Batata doce assada'
        },
        {
            dia: 'SÁBADO',
            cafe: hasGlutenIntolerance ? 'Crepioca + Queijo vegetal + Tomate' : 'Panqueca proteica + Frutas',
            lanche1: 'Uva + Nozes (se não tiver alergia)',
            almoco: 'Peixe + Arroz integral + Feijão verde + Cenoura refogada',
            lanche2: hasLactoseIntolerance ? 'Pudim de chia com leite vegetal' : 'Iogurte com frutas',
            jantar: 'Frango + Purê de mandioca + Salada de rúcula'
        },
        {
            dia: 'DOMINGO',
            cafe: 'Ovos mexidos + Abacate + Torrada (sem glúten se necessário)',
            lanche1: 'Banana + Pasta de amendoim',
            almoco: 'Carne assada + Batata doce + Vagem + Salada',
            lanche2: 'Vitamina de frutas vermelhas',
            jantar: hasSeafoodAllergy ? 'Omelete + Legumes salteados' : 'Camarão + Abobrinha + Quinoa'
        }
    ];
    
    cardapio.forEach(refeicao => {
        if (yPos > 260) {
            doc.addPage();
            pageCount++;
            yPos = 30;
        }
        
        doc.setFontSize(12);
        doc.setTextColor(44, 122, 44);
        doc.text(refeicao.dia, 20, yPos);
        yPos += 10;
        
        doc.setFontSize(9);
        doc.setTextColor(0, 0, 0);
        
        const refeicoes = [
            ['☀️ Café da manhã:', refeicao.cafe],
            ['🍎 Lanche da manhã:', refeicao.lanche1],
            ['🍽️ Almoço:', refeicao.almoco],
            ['🥤 Lanche da tarde:', refeicao.lanche2],
            ['🌙 Jantar:', refeicao.jantar]
        ];
        
        refeicoes.forEach(([tipo, comida]) => {
            doc.text(tipo, 25, yPos);
            yPos += 5;
            // Quebrar linha se a comida for muito longa
            const palavras = comida.split(' ');
            let linha = '';
            palavras.forEach(palavra => {
                if (linha.length + palavra.length > 45) {
                    doc.text(linha, 25, yPos);
                    yPos += 4;
                    linha = palavra + ' ';
                } else {
                    linha += palavra + ' ';
                }
            });
            if (linha.trim()) {
                doc.text(linha, 25, yPos);
                yPos += 6;
            }
        });
        yPos += 8;
    });
    
    // =================== PÁGINA RECEITAS ===================
    doc.addPage();
    pageCount++;
    
    doc.setFontSize(22);
    doc.setTextColor(44, 122, 44);
    doc.text('RECEITAS PERSONALIZADAS', 20, 25);
    
    doc.setDrawColor(44, 122, 44);
    doc.setLineWidth(2);
    doc.line(20, 30, 190, 30);
    
    yPos = 45;
    
    // Receitas adaptadas às restrições
    const receitas = [
        {
            nome: hasLactoseIntolerance ? 'Omelete Vegana de Claras' : 'Omelete Proteica',
            categoria: 'Café da Manhã',
            tempo: '15 min',
            calorias: '280 cal',
            ingredientes: hasLactoseIntolerance ? [
                '4 claras de ovo',
                '1 ovo inteiro', 
                '1 xícara de espinafre',
                '5 tomates cereja',
                '1 col. chá azeite',
                'Sal, pimenta, ervas'
            ] : [
                '3 claras de ovo',
                '1 ovo inteiro',
                '1 col. sopa queijo cottage',
                '1 xícara espinafre',
                '5 tomates cereja',
                '1 col. chá azeite'
            ],
            preparo: [
                'Bata as claras com o ovo inteiro',
                'Tempere com sal e pimenta',
                'Aqueça o azeite na frigideira',
                'Refogue o espinafre por 1 min',
                'Adicione os ovos batidos',
                'Coloque os tomates por cima',
                'Cozinhe em fogo médio 3-4 min',
                'Dobre e sirva quente'
            ]
        },
        {
            nome: hasGlutenIntolerance ? 'Panqueca de Tapioca Proteica' : 'Panqueca de Aveia Proteica',
            categoria: 'Café da Manhã',
            tempo: '20 min',
            calorias: '420 cal',
            ingredientes: hasGlutenIntolerance ? [
                '1/2 xícara goma de tapioca',
                '2 ovos inteiros',
                '1 banana amassada',
                '1 scoop whey protein',
                '1 col. chá canela',
                'Óleo de coco para untar'
            ] : [
                '1/2 xícara aveia em flocos',
                '2 ovos inteiros',
                '1 banana amassada',
                '1 scoop whey protein',
                '1 col. chá canela',
                '1 col. chá fermento'
            ],
            preparo: [
                'Bata todos ingredientes no liquidificador',
                'Deixe descansar 5 minutos',
                'Aqueça frigideira antiaderente',
                'Unte com óleo de coco',
                'Faça panquecas pequenas',
                'Cozinhe 2-3 min cada lado',
                'Sirva com frutas frescas'
            ]
        },
        {
            nome: hasSeafoodAllergy ? 'Frango Grelhado Temperado' : 'Salmão Grelhado com Ervas',
            categoria: 'Almoço/Jantar',
            tempo: '25 min',
            calorias: hasSeafoodAllergy ? '350 cal' : '380 cal',
            ingredientes: hasSeafoodAllergy ? [
                '150g peito de frango',
                '2 dentes alho amassados',
                '1 col. sopa azeite',
                'Suco de 1 limão',
                'Sal, pimenta, orégano',
                'Ervas frescas'
            ] : [
                '120g salmão fresco',
                '2 dentes alho amassados',
                '1 col. sopa azeite',
                'Suco de 1 limão',
                'Sal, pimenta, dill',
                'Ervas frescas'
            ],
            preparo: [
                'Tempere a proteína com sal e pimenta',
                'Misture alho, azeite e limão',
                'Marine por 20 minutos',
                'Aqueça grelha ou frigideira',
                'Grelhe 6-8 min cada lado (frango)',
                'Grelhe 4-5 min cada lado (salmão)',
                'Deixe descansar 5 min',
                'Finalize com ervas frescas'
            ]
        }
    ];
    
    receitas.forEach(receita => {
        if (yPos > 240) {
            doc.addPage();
            pageCount++;
            yPos = 30;
        }
        
        // Título da receita
        doc.setFontSize(14);
        doc.setTextColor(44, 122, 44);
        doc.text(receita.nome, 20, yPos);
        yPos += 8;
        
        // Info da receita
        doc.setFontSize(9);
        doc.setTextColor(100, 100, 100);
        doc.text(`${receita.categoria} | ${receita.tempo} | ${receita.calorias}`, 20, yPos);
        yPos += 12;
        
        // Ingredientes
        doc.setFontSize(11);
        doc.setTextColor(0, 0, 0);
        doc.text('INGREDIENTES:', 20, yPos);
        yPos += 7;
        
        doc.setFontSize(9);
        receita.ingredientes.forEach(ingrediente => {
            doc.text('• ' + ingrediente, 25, yPos);
            yPos += 5;
        });
        yPos += 5;
        
        // Preparo
        doc.setFontSize(11);
        doc.text('MODO DE PREPARO:', 20, yPos);
        yPos += 7;
        
        doc.setFontSize(9);
        receita.preparo.forEach((passo, index) => {
            doc.text(`${index + 1}. ${passo}`, 25, yPos);
            yPos += 5;
        });
        yPos += 15;
    });
    
    // =================== PÁGINA LISTAS DE ALIMENTOS ===================
    doc.addPage();
    pageCount++;
    
    doc.setFontSize(22);
    doc.setTextColor(44, 122, 44);
    doc.text('LISTAS DE ALIMENTOS', 20, 25);
    
    doc.setDrawColor(44, 122, 44);
    doc.setLineWidth(2);
    doc.line(20, 30, 190, 30);
    
    yPos = 45;
    
    // Lista adaptada às restrições
    const listas = [
        {
            categoria: 'PROTEÍNAS MAGRAS ✅',
            permitidos: hasSeafoodAllergy ? [
                'Peito de frango sem pele',
                'Peito de peru natural', 
                'Carne bovina magra',
                'Ovos inteiros orgânicos',
                'Clara de ovos',
                'Tofu orgânico',
                'Lentilha, grão-de-bico'
            ] : [
                'Peito de frango sem pele',
                'Peito de peru natural',
                'Carne bovina magra', 
                'Peixes (salmão, atum, tilápia)',
                'Frutos do mar (camarão, lula)',
                'Ovos inteiros orgânicos',
                'Lentilha, grão-de-bico'
            ],
            evitar: [
                'Carnes processadas',
                'Bacon e embutidos',
                'Nuggets industrializados',
                'Hambúrgueres prontos'
            ]
        },
        {
            categoria: 'CARBOIDRATOS COMPLEXOS ✅',
            permitidos: hasGlutenIntolerance ? [
                'Arroz integral',
                'Quinoa',
                'Batata doce',
                'Mandioca/Aipim',
                'Inhame',
                'Tapioca',
                'Frutas da época'
            ] : [
                'Arroz integral',
                'Quinoa',
                'Aveia em flocos',
                'Batata doce',
                'Pão integral 100%',
                'Macarrão integral',
                'Frutas da época'
            ],
            evitar: hasGlutenIntolerance ? [
                'Trigo e derivados',
                'Pão comum',
                'Massas comuns',
                'Biscoitos com glúten',
                'Cerveja'
            ] : [
                'Açúcar refinado',
                'Pão branco',
                'Arroz branco',
                'Biscoitos industrializados',
                'Doces em geral'
            ]
        }
    ];
    
    if (hasLactoseIntolerance) {
        listas.push({
            categoria: 'SUBSTITUTOS LÁCTEOS ✅',
            permitidos: [
                'Leite de amêndoas',
                'Leite de aveia',
                'Leite de coco',
                'Iogurte de coco',
                'Queijo vegetal',
                'Manteiga de coco'
            ],
            evitar: [
                'Leite de vaca',
                'Queijos comuns',
                'Iogurte tradicional',
                'Manteiga comum',
                'Creme de leite',
                'Sorvetes à base de leite'
            ]
        });
    }
    
    listas.forEach(lista => {
        if (yPos > 220) {
            doc.addPage();
            pageCount++;
            yPos = 30;
        }
        
        doc.setFontSize(12);
        doc.setTextColor(44, 122, 44);
        doc.text(lista.categoria, 20, yPos);
        yPos += 10;
        
        doc.setFontSize(9);
        doc.setTextColor(0, 0, 0);
        
        lista.permitidos.forEach(item => {
            doc.text('✅ ' + item, 25, yPos);
            yPos += 5;
        });
        
        yPos += 5;
        doc.setTextColor(200, 0, 0);
        doc.text('EVITAR:', 25, yPos);
        yPos += 6;
        
        lista.evitar.forEach(item => {
            doc.text('❌ ' + item, 25, yPos);
            yPos += 5;
        });
        
        yPos += 15;
        doc.setTextColor(0, 0, 0);
    });
    
    // =================== PÁGINA ORIENTAÇÕES ESPECÍFICAS ===================
    doc.addPage();
    pageCount++;
    
    doc.setFontSize(22);
    doc.setTextColor(44, 122, 44);
    doc.text('ORIENTAÇÕES PERSONALIZADAS', 20, 25);
    
    doc.setDrawColor(44, 122, 44);
    doc.setLineWidth(2);
    doc.line(20, 30, 190, 30);
    
    yPos = 45;
    doc.setFontSize(10);
    doc.setTextColor(0, 0, 0);
    
    // Orientações específicas por condição de saúde
    if (hasDiabetes) {
        doc.setFontSize(12);
        doc.setTextColor(200, 0, 0);
        doc.text('⚠️ ORIENTAÇÕES PARA DIABETES:', 20, yPos);
        yPos += 10;
        doc.setFontSize(10);
        doc.setTextColor(0, 0, 0);
        const diabetesOrientacoes = [
            'Monitore a glicemia antes e após refeições',
            'Prefira carboidratos de baixo índice glicêmico',
            'Distribua carboidratos ao longo do dia',
            'Evite açúcares simples e doces',
            'Mantenha horários regulares das refeições'
        ];
        diabetesOrientacoes.forEach(orientacao => {
            doc.text('• ' + orientacao, 25, yPos);
            yPos += 6;
        });
        yPos += 10;
    }
    
    if (hasHypertension) {
        doc.setFontSize(12);
        doc.setTextColor(200, 0, 0);
        doc.text('⚠️ ORIENTAÇÕES PARA HIPERTENSÃO:', 20, yPos);
        yPos += 10;
        doc.setFontSize(10);
        doc.setTextColor(0, 0, 0);
        const hipertensaoOrientacoes = [
            'Reduza o consumo de sódio para menos de 2g/dia',
            'Aumente o consumo de potássio (banana, espinafre)',
            'Evite alimentos industrializados ricos em sódio',
            'Use temperos naturais em vez de sal',
            'Monitore a pressão arterial regularmente'
        ];
        hipertensaoOrientacoes.forEach(orientacao => {
            doc.text('• ' + orientacao, 25, yPos);
            yPos += 6;
        });
        yPos += 10;
    }
    
    if (hasLactoseIntolerance) {
        doc.setFontSize(12);
        doc.setTextColor(200, 0, 0);
        doc.text('⚠️ ORIENTAÇÕES PARA INTOLERÂNCIA À LACTOSE:', 20, yPos);
        yPos += 10;
        doc.setFontSize(10);
        doc.setTextColor(0, 0, 0);
        const lactoseOrientacoes = [
            'Substitua leite comum por leites vegetais',
            'Use iogurtes de coco ou amêndoas',
            'Verifique rótulos de produtos industrializados',
            'Experimente queijos vegetais',
            'Suplementar cálcio se necessário'
        ];
        lactoseOrientacoes.forEach(orientacao => {
            doc.text('• ' + orientacao, 25, yPos);
            yPos += 6;
        });
        yPos += 10;
    }
    
    // Orientações gerais
    doc.setFontSize(12);
    doc.setTextColor(44, 122, 44);
    doc.text('ORIENTAÇÕES GERAIS:', 20, yPos);
    yPos += 10;
    doc.setFontSize(10);
    doc.setTextColor(0, 0, 0);
    
    let orientacoes = [
        'Beba pelo menos 2-3 litros de água por dia',
        'Faça 5-6 refeições pequenas ao longo do dia',
        'Nunca pule o café da manhã',
        'Pratique atividade física regularmente',
        'Durma pelo menos 7-8 horas por noite',
        'Prefira sempre alimentos integrais',
        'Mastigue bem os alimentos',
        'Mantenha horários regulares'
    ];
    
    // Orientações específicas por objetivo
    if (userData.goal === 'lose_weight') {
        orientacoes.push('Crie déficit calórico de 500 cal/dia');
        orientacoes.push('Priorize proteínas em todas refeições');
        orientacoes.push('Pratique cardio 4-5x/semana');
    } else if (userData.goal === 'gain_muscle') {
        orientacoes.push('Mantenha superávit calórico de 300 cal/dia');
        orientacoes.push('Consuma proteína a cada 3-4 horas');
        orientacoes.push('Foque em musculação');
    }
    
    orientacoes.forEach(orientacao => {
        if (yPos > 270) {
            doc.addPage();
            pageCount++;
            yPos = 30;
        }
        doc.text('• ' + orientacao, 25, yPos);
        yPos += 6;
    });
    
    // =================== PÁGINA FINAL - CRONOGRAMA ===================
    doc.addPage();
    pageCount++;
    
    doc.setFontSize(22);
    doc.setTextColor(44, 122, 44);
    doc.text('CRONOGRAMA E DICAS FINAIS', 20, 25);
    
    doc.setDrawColor(44, 122, 44);
    doc.setLineWidth(2);
    doc.line(20, 30, 190, 30);
    
    yPos = 45;
    
    doc.setFontSize(14);
    doc.setTextColor(44, 122, 44);
    doc.text('⏰ HORÁRIOS IDEAIS DAS REFEIÇÕES', 20, yPos);
    yPos += 15;
    
    doc.setFontSize(11);
    doc.setTextColor(0, 0, 0);
    
    const horarios = [
        ['Café da manhã:', '7h00 - 8h00'],
        ['Lanche da manhã:', '10h00 - 10h30'], 
        ['Almoço:', '12h00 - 13h00'],
        ['Lanche da tarde:', '15h30 - 16h00'],
        ['Jantar:', '19h00 - 20h00']
    ];
    
    horarios.forEach(([refeicao, horario]) => {
        doc.text(refeicao, 25, yPos);
        doc.text(horario, 100, yPos);
        yPos += 8;
    });
    
    yPos += 15;
    doc.setFontSize(14);
    doc.setTextColor(44, 122, 44);
    doc.text('📅 CRONOGRAMA DE RESULTADOS', 20, yPos);
    yPos += 15;
    
    doc.setFontSize(10);
    doc.setTextColor(0, 0, 0);
    
    const cronograma = [
        'Semana 1-2: Adaptação do corpo, redução de inchaço',
        'Semana 3-4: Primeiros resultados visíveis',
        'Mês 2: Mudanças na composição corporal',
        'Mês 3: Resultados consolidados',
        'Mês 4+: Manutenção e refinamentos'
    ];
    
    cronograma.forEach(item => {
        doc.text('• ' + item, 25, yPos);
        yPos += 8;
    });
    
    yPos += 15;
    doc.setFontSize(12);
    doc.setTextColor(44, 122, 44);
    doc.text('💪 Você tem tudo para alcançar seus objetivos!', 20, yPos);
    
    console.log(`PDF gerado com ${pageCount} páginas para ${userData.name}`);
    return doc;
}

// Função de download
function downloadFile(type) {
    if (type !== 'dieta-personalizada') {
        alert('Este material está disponível na sua área de membros exclusiva! Verifique seu e-mail para o link de acesso.');
        return;
    }

    try {
        const doc = generateDietaPDF();
        const userData = window.currentUserData || { name: 'Cliente' };
        const filename = `Dieta_Personalizada_${userData.name.replace(/\s+/g, '_')}_DrGiovana.pdf`;
        doc.save(filename);
        
    } catch (error) {
        console.error('Erro ao gerar PDF:', error);
        alert('Erro ao gerar PDF. Tente novamente.');
    }
}

// Salvar progresso
function saveUserProgress() {
    try {
        if (typeof(Storage) !== "undefined") {
            sessionStorage.setItem('userCompleted', 'true');
            sessionStorage.setItem('completionDate', new Date().toISOString());
        }
    } catch (error) {
        console.log('sessionStorage não disponível');
    }
}

// Executar ao carregar
saveUserProgress();
    </script>
</body>
</html>